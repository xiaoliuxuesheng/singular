01、本章内容

1. 本章内容
   1. 进程和线程的概念
   2. 并行和并发的概念
   3. 线程的基本使用

02、进程线程的概念呢

1. 进程：
2. 线程：
3. - 

03、并行与并发的概念

- 并发
- 并行

04、线程应用-异步调用

1. 同步和异步
   - 方法调用者需要等待调用结果称为同步
   - 方法调用者不需要等待调用结果就能继续执行就是异步

05、线程应用-提示效率

1. 提升效率案例说明：地球人都知道

06、线程应用-提升效率代码演示

1. 环境搭建
   - 基准测试工具：JMH会执行预热，多次执行获取平均
   - CPU核心限制：使用虚拟机，分配合适的核心；

07、线程应用-小结

- 多核执行多线程可以提高性能
- 单核执行多线程性能反而会变低：线程切换需要时间



001、01、课程内容

- 课程内容
  - 进程
  - 线程
  - 并发
  - 并行
- 学习作用：哪有什么岁月静好

002、02、课程组织

1. 课程组织
   1. 进程
   2. 线程
   3. 并发共享模型
      1. 管程
      2. JMM
      3. 无锁悲观锁
      4. 不可变
      5. 并发工具：线程池、JUC、disruptor、guava
      6. 异步编程：ComplatableFuture、反应式
   4. 并发非共享模型
      1. 私有
      2. Actor
   5. 并行
      1. 函数式编程、并行编程
   6. 其他领域
   7. 应用：效率、限流、同步、异步、缓存、对列、分治、统筹
   8. 原理：
   9. 设计模式：

003、03、预备知识

1. 预备知识
   1. 不是初学者、接触过web开发、知道分布式原理、会使用Java8的新特性lambda表达式、熟悉日志框架、会观察线程





##  ***

# java并发包

1. tools：
2. locks：锁
3. collections：集合
4. executor：执行器
5. aotmic：原子包

# 多核CPU缓存架构

- 主内存 -> 一级缓存 -> 二级缓存 -三级缓存 -> CPU寄存器

# volatile

- Java多线程内存模型是类似CPU缓存模型的，是基于CPU缓存模型建立的，Java内存模型是在JVM虚拟机中屏蔽的底层的不同机器的区别：java线程 读取 工作内存 保存 主内存共享变量 -》 主内存保存着共享变量
- 线程操作共享变量，首先会读取主内存中共享变量的副本保存到工作内存中的，而java线程操作的是工作内存中的变量
- JMM数据原子操作
  - read：读取：从主内存读取数据
  - load：载入：将主内存读取到的数据写入工作内存
  - usr：使用：从工作内存读取数据来计算
  - assign：赋值：将计算好的值重新复制到工作内存中
  - store：存储：将工作内存数据写入到主内存
  - write：将store过去的变量赋值给主内存的变量
  - lock：锁定：将主内存变量加锁，标识为线程独占状态
  - unlock：解锁：将主内存变量解锁，解锁后其他线程可以锁定改变量
- 缓存一致性协议：MESI：多个CPU从主内存读取同一个数据到各自的高速缓存，当其中一个CPU修改了缓存内的数据，改数据会马上同步回主内存，其他CPU通过总线嗅探机制可以感知到数据变化从而将自己缓存里的数据失效，
- 缓存加锁：缓存锁的核心机制是基于缓存一致性协议来实现的，一个处理器的的缓存回写到内存会导致其他处理器的缓存失效
- volatile底层原理：通过汇编的lock前缀指令，锁定这块区域内存的缓存（缓存行锁定）并写回到主存：
  - lock会将当前处理器缓存行的数据立即写回到系统内存；
  - 这个写回操作会使其他CPU里缓存改变量的数据无效
  - 立即写回系统内存，提供内存屏障功能，使lock前后的操作不能进行指令重排序
- 并发三大特性：可见性、有序性、原子性；volatile可以保证可见性和有序性，但是不能保证原子性
- 指令重拍：在不影响单线程程序执行结果的前提下，计算机为了更大限度的发挥机器性能，会对机器指令重排序优化：重排序原则：as-if-serial和happens-before
  - as-if-serial：不管怎么重排序，在单线程的执行结果不能改变
  - happens-before：不同的规则都不可以重排序
- 内存屏障：

# synchronized

# 线程

- 线程
  - 基础
  - 同步
  - 互斥
- JUC包：是java并发编程的核心
  - 锁实现的：AQS（是JUC包的核心）

- AQS：抽象队列同步器
  - 抢锁
  - 释放锁
  - 入队
  - 出队
  - 阻塞
  - 唤醒