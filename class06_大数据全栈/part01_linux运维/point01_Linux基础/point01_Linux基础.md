# 前言

## 运维职业发展

1. Linux运维中级工程师：1-2年
2. Linux高级运维工程师：3-5年
3. 运维开发工程师：3-5年（会代码的全栈运维）
4. 数据库运维工程师：3-5年
5. 云计算高级架构师：5-10年

# 第一章 Linux基础

## 1.1 Linux系统简介

1. Unix与Linux发展史

   - Unix的发展

     | 时间点 | 重要变动                                                     |
     | ------ | ------------------------------------------------------------ |
     | 1969年 | 肯·汤姆森开发出了Unix系统（UNI小而精巧）                     |
     | 1971年 | 肯·汤姆森和丹尼斯·里奇发明了C语言，重写了UNIX                |
     | 1973年 | 用C语言重写了UNIX：UNIX现在主要发行版本<br />AIX    →    IBM<br />UC     →    HP<br />Solaris    →    SUN<br />Linux    →    Read Hat Linux、Ubuntu、FreeBSD |

   - Linux系统的发展

     | 时间点 | 变动说明                                  |
     | ------ | ----------------------------------------- |
     |        | UNIX闭源                                  |
     |        | 大学老师独自开发了MINIX作为教学用         |
     | 1991年 | 芬兰大学生Linus Torvalds开发了Linux并开源 |

2. Linux版本分类

   - 内核版：www.kernel.com（官网），有Linus Torvalds负责发布并维护
     - RHEL6.X（现在开发学习在6.5以上）
     - REHL7.0
   - 发行版：内核版免费下载，对内核进行一层包装成了发行版
     - RedHat系列：Redhat、CentOS、Fedora、SUSE、红旗Linux、GentooLinux、
       - 服务器版：RHEL（RedHat Enterprise Linux）（CentOS照抄REHL被收购，免费使用）
       - 个人版：Fedora（界面漂亮，性能高，功能完整）
     - Debian系列：Debian、Ubuntu、Knoppix

3. 开源软件简介

   - 服务器：Apache、Nginx
   - 数据库：MySQL、MongoDB、Redis
   - 脚本语言：PHP、Python、Ruby
   - 开发语言：Java、Go

4. Linux应用领域

   - 基于LInux的服务器
   - Linux嵌入式领域：智能手机、只能硬件

## 1.2 虚拟机的使用

1. VMware虚拟机安装：是一个虚拟的PC的软件，可以在操作系统模拟一个新的硬件环境，可以在这个模拟的硬件环境中安装操作系统，与宿主机是两个完全独立的操作系统；
   - **步骤一**：稍后安装操作系统
   - **步骤二**：内存设置：Linux最小内存628M（小于会自动开启简易安装），运行内存几十兆足够；设置1024M
   - **步骤三**：处理器数量和每个处理器的核数和宿主机的内核相符即可：
   - **步骤四**：CD/DVD选择安装ISO
   - **步骤五**：虚拟机管理（安装快照、快照克隆）
   - **步骤六**：网络配置，VMware安装后会在宿主机多两个虚拟网卡（VMnet1、VMnet8）和本地真实网卡
     - 桥接：是虚拟机和本地真实网卡的连接通信，默认自动桥接（可以使用本地网卡访问互联网）
     - NAT模式：是虚拟机和VMnet8虚拟网卡的连接通信（不能连接局域网，但是可以访问公网）
     - 仅主机模式：是虚拟机和VMnet1虚拟网卡的连接通信（不可以连接局域网，不能连接公网）

## 1.3 Linux安装

1. Linux分区格式化
   - 磁盘分区：使用分区编辑器在磁盘上划分几个逻辑部分（不是吧磁盘隔开成小物理单元块），磁盘分区后，不同类的目录与文件可以存储进不同的分区（类似Windows系统中的盘）；
2. 分区类型
   - 主分区：最多只有4个（操作系统必须要有一个主分区，用于操作系统的激活盘）
   - 扩展分区：
     - 最多只能有1个
     - 主分区加扩展分区最多有4个
     - 不能写入数据，主要用户拆分逻辑分区
   - 逻辑分区：可以存储数据
3. 两中分区表形式
   - MBR（主引导记录分区表）：古老的分区表，最大支持2.1T硬盘（超出的部分不能使用），每块硬盘最多支持4个分区；可以将其中一个主分区配置为扩展分区，通过将扩展分区拆分为逻辑分区（最多拆分为10个），就突破4个分区的限制；
   - GPT（全局唯一标识分区表）：GPT支持9.4ZB硬盘，理论上支持的分区数没有限制（Windows限制128个）
4. 格式化：分区后必须将分区格式化（高级格式化）：又称逻辑格式化，他是指根据用户选定的文件系统（FAT16、FAT32、NTFS、EXT2、EXT3、EXT4、XFS等），在磁盘的特定区域写入特定数据，在分区中划出一片用于存放文件分配表、目录表等用于文件管理的磁盘空间（简述就是为了写入文件系统），越先进的文件系统支持的单个文件越大、读写越快、越安全；格式化目的是为了再磁盘中分区域：例如Linux的EXT4格式化原理：分区分为两个部分，小的部分用于保存文件的iNode（128字节）索引：包含文件权限、node号、修改时间，大的部分分为4kb的block存储数据（Windows磁盘碎片整理就是将文件的block连续存放）；
   - Windows系统大部分是NTFS；
   - REHL6中用的EXT4；
   - CentOS7中用XFS；
5. 硬件设备文件名：Linux中所有硬件设备是以文件形式表现的
   - /dev/hda1：IED硬盘接口（ha表示硬盘类型40个针）
   - /dev/sda1：SCSI硬盘接口、SATA硬盘接口（sd代表SCSI、SATA、USB接口L型接口）；a表示是第几块硬盘（a表示第一块，b表示弟二块，。。。）；数字表示分区位置：1,2,3,4表示最多的4个主分区，逻辑分区的位置是从5开始，无论主分区有几个
6. 设备挂载：（Windows中定义盘符）是指Linux中的**已存在空目录**挂载到硬盘设备上的步骤
   - 必须分区
     - /：根分区（理论上所有空目录，包括新建目录都可以作为挂载点，但是/bin、/lib、/etc这几个必须和根目录放在同一分区）
     - swap分区：交换分区，如果主机内存小于4G，swap空间是内存两倍；如果主机内存大于4G，swap与内存保持一致；
   - 推荐分区：/boot（启动分区：1G）
   - 常用分区：
     - /home：用户文件服务器
     - /www：用户web服务器
7. 安装Linux
   - 选择安装语言是简体中文：必须的安装中文会安装中文字体与中文字符集（如果会装字符集可以忽略）
   - 设置root用户密码和当前用户名和密码
   - 安装基本环境，新建初始化快照
8. Linux的IP配置
   - setup进入继承界面进行配置
   - on boot
   - service network restart
9. Linux远程管理工具
   - FinalShell：http://www.hostbuf.com/t/988.html
   - XShell：

## 1.4 Linux文件系统



## 1.5 Linux命令格式

1. 命令提示符

   ```sh
   [root@localhost ~] #
   ```

   > - `[]` 是命令提示符的分隔符，没有特殊含义
   > - root：表示当前登录用户
   > - @：无特殊含义，用于分隔用户与后面的主机IP
   > - localhost：登录的主机IP
   > - ~：当前所在目录的最后一级目录
   > - \#：命令提示符（普通用户的提示符是#，超级管理员用户的提示符是$）

2. 命令格式

   ```sh
   命令 [选项] [参数]
   ```

   > - `[]`：方括号代表里面的值是可选项
   > - 选项的作用：用于调整命令的功能
   > - 参数的作用：用于指定命令的执行对象
   
3. 

# 第二章 Linux基础命令

## 2.1 文件目录相关命令

### :dash: pwd 查询路径

### :dash: cd 切换目录

```sh
cd 目录路径
```

- 目录参数字符说明

  | 符号    | 说明                       |
  | ------- | -------------------------- |
  | ~       | 代表当前登录用户的主目录   |
  | ~用户名 | 表示切换至指定用户的主目录 |
  | -       | 代表上次所在目录           |
  | .       | 代表当前目录               |
  | ..      | 代表上级目录               |

### :dash: ls 文件列表

- 常用选项说明

  | 选项 | 功能                                                         |
  | ---- | ------------------------------------------------------------ |
  | -a   | 显示全部的文件，包括隐藏文件（开头为 . 的文件）也一起罗列出来 |
  | -d   | 仅列出目录本身，而不是列出目录内的文件数据。                 |
  | -h   | 以人们易读的方式显示文件或目录大小，如 1KB、234MB、2GB 等。  |
  | -i   | 显示 inode 节点信息。                                        |
  | -l   | 使用长格式列出文件和目录信息。                               |
  | -R   | 连同子目录内容一起列出来，等於将该目录下的所有文件都显示出来。 |
  | -S   | 以文件容量大小排序，而不是以文件名排序。                     |
  | -t   | 以时间排序，而不是以文件名排序。                             |

### :dash: mkdir 创建文件夹

```sh
mkdir [选项] 文件夹名称
```

> - 选项`-p`：递归执行目录创建

### :dash: rmdir 删除文件夹

```sh
rmdir [选项] 文件夹名称
```

> - 选项`-p`：默认不可以删除非空文件夹，使用该选项递归执行目录删除

### :dash: touch  新建空文件

```sh
touch 文件名称
```

> - 如果文件已存在，则会修改文件的最后修改时间

### :dash: file 查看文件类型

### :dash: stat 查看文件详细信息

```sh
stat 文件名称
```

> - Assess：表示文件的最后访问时间
> - Modify：表示文件数据的最后修改时间
> - Change：表示文件状态的最后修改时间

### :dash: cat 查看文件内容

```sh
cat [选项] 文件名称
```

> | 选项 | 说明                                  |
> | ---- | ------------------------------------- |
> | -E   | Enter：表示显示行尾回车符             |
> | -T   | Tab：表示Tab制表符                    |
> | -v   | 列出文本中特殊字符                    |
> | -A   | All：表示-vET的组合，显示所有隐藏字符 |
> | -n   | 显示行号                              |

### :dash: more 分屏显示文本内容

```sh
more 文件名称
```

> | 分屏显示快捷键 | 作用         |
> | -------------- | ------------ |
> | 空格           | 向下翻页     |
> | b              | 向上翻页     |
> | 回车           | 向下移动一行 |
> | q              | 退出         |

### :dash: less 分行显示文本内容

```sh
less 文件夹称
```

> | 分屏显示快捷键 | 作用             |
> | -------------- | ---------------- |
> | 空格           | 向下翻页         |
> | b              | 向上翻页         |
> | 回车           | 向下移动一行     |
> | 上下方向键     | 可以上下移动一行 |
> | q              | 退出             |

### :dash: head  查看文件头

```sh
head [选项] 文件夹称
```

> - 选项`-n`：默认只查看10行，该选项用于指定查看的行数

### :dash: tail  查看文件为

```sh
rmdir [选项] 文件夹名称
```

> - 选项`-n`：默认只查看10行，该选项用于指定查看的行数
> - 选项`-f`：用于监听文件的末尾新增内容

### :dash: rm  删除文件

```sh
rm [选项] 文件夹或文件
```

> | 选项 | 说明                                                         |
> | ---- | ------------------------------------------------------------ |
> | -f   | 强制删除（force）                                            |
> | -i   | 在删除文件或目录之前，系统会给出提示信息                     |
> | -r   | 递归删除，可删除指定目录及包含的所有内容，包括所有的子目录和文件 |

### :dash: cp  复制

```sh
cp [选项] 要复制的文件  复制的目的地
```

> | 选项 | 说明                                                         |
> | ---- | ------------------------------------------------------------ |
> | -a   | 相当于 -d、-p、-r 选项的集合                                 |
> | -d   | 如果源文件为软链接（对硬链接无效），则复制出的目标文件也为软链接； |
> | -p   | 复制后目标文件保留源文件的属性                               |
> | -r   | 递归复制，用于复制目录                                       |
> | -i   | 交互的方式询问，如果目标文件已经存在，则会询问是否覆盖       |
> | -u   | 若目标文件比源文件有差异，则使用该选项可以更新目标文件，此选项可用于对文件的升级和备用 |

### :dash: mv 剪切移动

```sh
mv [选项] 要剪切的文件  新路径（重命名）
```

> | 选项 | 说明                                           |
> | ---- | ---------------------------------------------- |
> | -f   | 在 mv 操作要覆盖某已有的目标文件时不给任何指示 |
> | -i   | 若指定目录已有同名文件，则先询问是否覆盖旧文件 |

## 2.2 权限命令

## 2.3 查找搜索命令

## 2.4 压缩与解压缩

## 2.5 网络命令

## 2.6 挂载命令

## 2.7 其他重要命令

### 1.​ echo 内容输出



- 格式：<kbd>echo [选项] "输出内容"</kbd>：如果输出内容没有特殊内容，可以不适用双引号。

  - 常用选项说明

    | 选项    | 作用                       |
    | ------- | -------------------------- |
    | **-e**  | 支持反斜杠线控制的字符转换 |
    | **-n ** | 输出内容后不换行           |

  - 常用转义字符说明

    | 转义组合                  | 作用                         |
    | ------------------------- | ---------------------------- |
    | `\\`                      | 输出`\`本身                  |
    | `\t`                      | 制表符                       |
    | `\n`                      | 换行符                       |
    | `\e`                      | ESC键                        |
    | \e[1;颜色 输入的字符\e[0m | 为输出的字符添加颜色或背景色 |

    > - 固定开头格式`\e[1;`  - 表示颜色开始的
    > - 固定结尾格式`\e[0m` - 表示颜色的结束
    > - 文字颜色：30m=黑、31m=红、32m=绿、33m=黄、34m=蓝、35m=洋、36m=青，37m=白色
    > - 背景颜色：40m=黑、41m=红、42m=绿、43m=黄、44m=蓝、45m=洋、46m=青，47m=白色

### 2.​ history 历史记录

- 格式：<kbd>history</kbd>

  - 历史命令记录是保存在家目录中：`~/.bash_history`文件中；
  - 历史记录文件中会保存本地登录后的历史记录，本次登录后的操作记录是保存在内存中，默认是在用户注销后系统自动将历史记录写入到历史记录文件中；
  - 设置历史记录保持数量：环境变量配置文件`/etc/profile`文件的HISTORY属性，推荐设置大一点；

- 常用选项及操作

  | 选项     | 作用                                     |
  | -------- | ---------------------------------------- |
  | `-w`     | 动刷新内存，将内存历史操作记录写入到文件 |
  | `-c`     | 清空历史记录                             |
  | 上下箭头 | 调用历史记录命令                         |
  | ! 编码   | 重复执行第n条历史记录                    |
  | !!       | 重复执行上次记录                         |
  | !字符串  | 重复执行最后一条以指定字符串开头的命令   |
  | !$       | 重复上一条命令的最后一个参数             |

### 3.​ alias 命令别名定义

- 格式

  - 设置别名 : 修改`~/.bashrc`文件可以永久生效

    ```sh
    alias 命令='别名'
    ```

    > 需要刷新该配置文件才可以生效

  - 查询别名 : alias

- 命令的执行顺序

  - 第一顺位 : 使用路径执行的命令
  - 第二顺位 : 别名
  - 第三顺位 : 执行bash内部命令
  - 第四顺位 : 安装PATH环境变量定义的目录查询到的第一个命令

# 第三章 VIM编辑器

## 3.1 VIM介绍

<font color=blue size=4>:anchor:vim简介</font>

- 是一种全屏幕纯文本编辑器，是Linux系统中vi的增强版（文本有颜色提示）；
- 不需要鼠标介入就可以完成对文本文件的所有操作；

<font color=blue size=4>:anchor: vim别名设置</font>

- 设置临时别名

  ```sh
  alias vi='vim'
  ```

- 修改别名配置文件：`~/.bashrc`

  ```sh
  alias vi='vim'
  ```

<font color=blue size=4​>:anchor: vim模式简介</font>

<img src='./imgs/vim_模式' width=80%/>

## 3.2 命令模式

> **主要是使用快捷键的地方**

1. 使用vi / vim 指定纯文本文件进入到命令模式；

2. 使用快捷键进入到输入模式

   | 快捷键 | 作用                 |
   | ------ | -------------------- |
   | a      | 当前光标字符之后     |
   | A      | 当前光标所在行尾     |
   | i      | 当前光标字符之前     |
   | I      | 当前光标所在行首     |
   | o      | 当前光标的下一行输入 |
   | O      | 当前光标的上一行输入 |

<font color=blue size=4>:anchor: 操作输入光标</font>

1. 移动光标

   - 上、下、左、右方向键；
   - h → 右、j → 上、k → 下、l → 左；

2. 文件头尾

   | 快捷键 | 作用         |
   | ------ | ------------ |
   | gg     | 光标到文件头 |
   | G      | 光标到文件位 |

3. 行首行尾

   | 快捷键 | 作用       |
   | ------ | ---------- |
   | ^      | 光标到行首 |
   | $      | 光标到行尾 |

4. 移动到指定行

   | 快捷键 | 作用      |
   | ------ | --------- |
   | :n     | n表示行号 |

<font color=blue size=4>:anchor: 文本编辑
</font>

1. 删除

   | 快捷键 | 作用         |
   | ------ | ------------ |
   | x      | 删除单个字母 |
   | nx     | 删除n个字母  |

2. 剪切

   | 快捷键  | 作用                 |
   | ------- | -------------------- |
   | dd      | 剪切当前行           |
   | ndd     | 剪切当前后之后的n行  |
   | :nx,nyd | 剪切第x行到第n行     |
   | dG      | 删除当前行到文件尾部 |

3. 粘贴

   | 快捷键    | 作用               |
   | --------- | ------------------ |
   | p（小写） | 粘贴到当前光标之后 |
   | P（大写） | 粘贴到当前光标之前 |

4. 复制

   | 快捷键 | 作用                    |
   | ------ | ----------------------- |
   | yy     | 复制光标所在行          |
   | nyy    | 复制光标所在行之后的n行 |

5. 撤销、恢复

   | 快捷键   | 作用   |
   | -------- | ------ |
   | u        | 撤销   |
   | ctrl + r | 反撤销 |

6. 替换

   | 快捷键 | 作用                   |
   | ------ | ---------------------- |
   | r      | 替换光标所在的字符     |
   | R      | 替换光标所在之后的字符 |
   | esc    | 退出替换模式           |

## 3.3 输入模式

> **对文本文件的输入操作**

1. 退出输入模式：esc

## 3.4 底线命令模式

> **主要对文本文件的增删改查操作**

1. 退出vim模式

   | 快捷键        | 作用           |
   | ------------- | -------------- |
   | :w            | 保存不退出     |
   | :w 新文件名称 | 另存为新文件   |
   | :wq           | 保存并退出     |
   | :!            | 强制           |
   | :q!           | 强制退出不保存 |
   | :wq!          | 强制退出并保存 |

2. vim配置说明：可以自定义配置文件`~/.vimrc`

   | 快捷键          | 作用              |
   | --------------- | ----------------- |
   | :set nu         | 显示行号          |
   | :set nonu       | 隐藏行号          |
   | :syntax on      | 开启shell颜色帮助 |
   | :syntax off     | 关闭shell颜色帮助 |
   | :set hlsearch   | 开启搜索高亮      |
   | :set nohlsearch | 关闭搜索高亮      |
   | :set ruler      | 开启右下角状态栏  |
   | :set nuruler    | 关闭有下降状态栏  |
   | :set showmode   | 开启左下角状态栏  |
   | :set noshowmode | 关闭左下角状态栏  |
   | :set list       | 显示隐藏字符      |
   | :set nolist     | 关闭显示隐藏字符  |

3. 查找

   | 快捷键    | 作用                 |
   | --------- | -------------------- |
   | /搜索内容 | 从光标处向下搜索内容 |
   | ?搜索内容 | 从光标处向上搜索内容 |
   | n         | 查找下一个           |
   | N         | 查找上一个           |

4. 替换

   ```sh
   :起始行号,终止行号s/旧字符/新字符 g
   ```

   - 起始行号和终止行号用%表示整个文本文档；
   - g表示替换所有的旧字符，否则只替换第一个；
   - ^ 表示正则符号：表示行首；

## 3.5 vim其他技巧

1. 在vim编辑模式中导入其他文件中的内容

   ```sh
   :r 其他文件路径   # 把其他文件中的内容添加到光标所在的位置
   ```

2. 在vim编辑模式中执行其他命令

   ```sh
   :! 命令		  # 执行其他命令并显示命令结果
   :r !命令		  # 执行命令并将命令结果添加到光标所在处
   ```

3. 自定义快捷键

   ```sh
   :map 快捷键 快捷键对应的命令
   ```

   - 快捷键不是手动输入，需要使用组合键：① ctrl + v ② 自定义的快捷键

4. 替换字符

   ```sh
   :ab 原字符 替换的字符
   ```

   - 使用时候，首先输入原字符加空格，按回车或tab键就会显示为替换的字符

5. vim打开多文件

   ```sh
   vim -o/O 文件1 文件2
   ```

   - 小写o表示上下屏打开文件：①ctrl + w ② 上下键选择屏幕
   - 大写O表示左右屏打开文件：①ctrl + w ② 左右键选择屏幕

# 第四章 Linux软件包管理

## 4.1 LInux软件包

<font color=blue size=4>:anchor: 源码包
</font>：是一大堆源代码程序，是由程序员按照特定的格式和语法编写出来的

- 源码包的安装需要把源代码编译为二进制代码，因此安装时间较长；
- 在安装过程中如果程序不要报错，初学者很难解决；

<font color=blue size=4>:anchor: 二进制
</font>：是源码包经过成功编译之后产生的包

- 二进制包在发布之前就已经完成了编译的工作，用户安装软件的速度较快，且安装过程报错几率大大减小。；
- 二进制包是 Linux 下默认的软件安装包，因此二进制包又被称为默认安装软件包
  1. RPM 包管理系统：功能强大，安装、升级、査询和卸载非常简单方便，Linux的Redhat系列使用；
  2. DPKG 包管理系统：由 Debian Linux 所开发的包管理机制；

<font color=blue size=4>:anchor: yum源 </font>

- 直接使用手工命令安装rpm软件包需要手工决绝软件包的依赖问题，yum是rpm在线安装的方法，yum安装会直接连接到rpm官方服务器安装软件包以及对应的依赖包，主要是解决了rpm软件包的依赖问题，本质还是rpm安装。

<font color=blue size=4>:anchor: **用于大量用户访问的服务建议使用源码包安装**
</font>

## 4.2 RPM软件包安装

<font color=blue size=4>:anchor: RPM包特点 </font>

- PRM包安装需要解决依赖性

  1. 树形依赖：按依赖顺序依次安装；

  2. 环形依赖：将依赖的包同时安装；

  3. 模块依赖（函数库依赖）：首先需要安装模块所在的软件包并安装对应的软件包，再安装软件包；

     [根据函数库查询软件包]: www.rpmfind.net

- RPM包名称格式

  ```sh
  # 包全名
  httpd-2.2.15-15.el6.centos.1.i686.rpm 
  ```

  > - httped：软件包名
  >
  > - 2.2.15：包的版本号，版本号的格式通常为`主版本号.次版本号.修正号`
  >
  > - 15：二进制包发布的次数
  >
  > - el*：软件发行商
  >
  > - centos：表示此包适用于 CentOS 系统
  >
  > - 硬件平台
  >
  >   | 平台名称 | 适用平台信息                                                 |
  >   | -------- | ------------------------------------------------------------ |
  >   | i386     | 386 以上的计算机都可以安装                                   |
  >   | i586     | 686 以上的计算机都可以安装                                   |
  >   | i686     | 奔腾 II 以上的计算机都可以安装，目前所有的 CPU 是奔腾 II 以上的，所以这个软件版本居多 |
  >   | x86_64   | 64 位 CPU 可以安装                                           |
  >   | noarch   | 没有硬件限制                                                 |
  >
  > - rpm：RPM 包的扩展名，表明这是编译好的二进制包

- rpm的默认安装路径

  | 安装路径        | 含 义                      |
  | --------------- | -------------------------- |
  | /etc/           | 配置文件安装目录           |
  | /usr/bin/       | 可执行的命令安装目录       |
  | /usr/lib/       | 程序所使用的函数库保存位置 |
  | /usr/share/doc/ | 基本的软件使用手册保存位置 |
  | /usr/share/man/ | 帮助文件保存位置           |

<font color=blue size=4>:anchor: 手工命令安装
</font>

```sh
rpm 选项 [参数] [包名]
```

- **常用选项说明**

  | 选项               | 作用                                                         |
  | ------------------ | ------------------------------------------------------------ |
  | -i                 | 安装（install）                                              |
  | -v                 | 显示更详细的信息（verbose）                                  |
  | -h                 | 显示安装进度（hash）                                         |
  | -U                 | 如果该软件没安装过则直接安装；若没安装则升级至最新版本       |
  | -F                 | 如果该软件没有安装，则不会安装，必须安装有较低版本才能升级。 |
  | -e                 | 卸载                                                         |
  | rpm -q 包名        | 查询软件包是否安装                                           |
  | rpm -qa            | 查询所有已安装软件                                           |
  | rpm -qip 包全名    | 查询未安装软件包                                             |
  | rpm -qi 包名       | 查询软件包的详细信息                                         |
  | rpm -ql 包名       | 命令查询软件包的文件列表                                     |
  | rpm -qlp 包全名    | 查询未安装软件包                                             |
  | rpm -qf 系统文件名 | 命令查询系统文件属于哪个RPM包                                |
  | rpm -qR 包名       | 查询软件包的依赖关系                                         |

- **常用参数说明**

  | 选项     | 作用                                       |
  | -------- | ------------------------------------------ |
  | --nodeps | 不检测依赖性安装                           |
  | --force  | 强制安装                                   |
  | --test   | 测试安装。不会实际安装，只是检测一下依赖性 |
  | --prefix | 指定安装路径。                             |

- **Linux RPM 包校验**

  ```sh
  # 校验系统中已安装的所有软件包
  rpm -Va
  
  # 校验指定 RPM 包中的文件
   rpm -V 已安装的包名
   
   # 校验某个系统文件是否被修改
   rpm -Vf 系统文件名
  ```

  > 验证信息：如`S.5....T. c /etc/httpd/conf/httpd.conf`
  >
  > - S：文件大小是否改变。
  > - M：文件的类型或文件的权限（rwx）是否改变。
  > - 5：文件MD5校验和是否改变（可以看成文件内容是否改变）。
  > - D：设备的主从代码是否改变。
  > - L：文件路径是否改变。
  > - U：文件的属主（所有者）是否改变。
  > - G：文件的属组是否改变。
  > - T：文件的修改时间是否改变。
  > - 文件类型
  >   - c：配置文件（configuration file）。
  >   - d：普通文档（documentation）。
  >   - g："鬼"文件（ghost file），很少见，就是该文件不应该被这个 RPM 包包含。
  >   - l：授权文件（license file）。
  >   - r：描述文件（read me）。

- **RPM数字证书验证**

  - 数字证书说明：RPM 包校验方法只能用来校验已安装的 RPM 包及其安装文件，如果 RPM 包本身就被动过手脚，此方法将无法解决问题，需要使用 RPM 数字证书验证方法。

  - 使用数字证书验证 RPM 包的方法具有如下 2 个特点：

    1. 必须找到原厂的公钥文件，然后才能进行安装。
    2. 安装 RPM 包会提取 RPM 包中的证书信息，然后和本机安装的原厂证书进行验证。如果验证通过，则允许安装；如果验证不通过，则不允许安装并发出警告。

  - 数字证书位置：`/etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6`，安装数字证书

    ```sh
    rpm --import /efc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
    ```

  - 查询系统中的数字证书：数字证书本身也是一个 RPM 包，因此可以用 rpm 命令查询数字证书的详细信息，也可以将其卸载

    ```sh
    rpm -qa|grep gpg-pubkey
    ```

- **RPM包文件提取**

  ```sh
  rpm2cpio 包全名|cpio -idv .文件绝对路径
  ```

  > **重点：**将提取出的文件首先放在当前目录中，再手动进行修改或覆盖

<font color=blue size=4>:anchor: yum在线安装
</font>

- 

# 第五章 Linux用户管理

## 5.1 用户与组概述

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;用户管理的作用：在成产开发中，引用部署在Linux服务器中，而且每台服务器的管理员可以有多个，并且每个管理员的权限设置需要有所区别，这样就存在资源共享与隔离的问题，所有必要的用户管理和权限配置就必不可少；用户权限配置主要是为了防范内部人员误操作；

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Linux原生的权限管理机制是基于用户角色的管理机制，也就是UGO+RWX/ACL权限控制。其中UGO是User、Group和Other的简称；RWX则是Read、Write和eXecute的简称；ACL是Access Control List的简称。Linux原生的访问控制称为自主访问控制；

- **自主访问控制（Discretionary Access Control）**：是指对象(比如程序、文件、进程)的拥有者可以任意修改或者授予此对象相应的权限。
- **基于标签的访问控制**：比如我们给程序和其访问的资源打上标签，这样程序就可以访问有标签的资源，对于没有标签的资源则不能访问。这种模式并非基于用户，而是基于许可。这种策略被称作强制访问控制（Mandatory Access Control ，简称MAC）。其中SELinux就是强制访问控制。

## 5.2 用户组相关文件

### <font color=blue size=4>1. ​用户信息文件：/etc/passwd</font>

- `/etc/passwd`：在这个文件中，其中的每一行代表一个用户，每一行用冒号分隔为7列，如下：

  ```sh
  panda:x:1000:1000:panda:/home/panda:/bin/bash
    ①   ②   ③    ④    ⑤        ⑥          ⑦    
  ```

- 用户信息文件字段说明

  | 字段列号 | 作用                                                         |
  | -------- | ------------------------------------------------------------ |
  | 1        | 用户名称                                                     |
  | 2        | 密码位（密码表示），代表这个用户有密码，真正的密码在/etc/shadow中 |
  | 3        | 是用户UID：Linux系统根据UID区分用户 <br />- 超级用户的UID：0 - <br />系统用户的UID：1-499，不能用来登陆，主要是用于运行系统或服务 <br />- 普通用户的UID：500-65535， |
  | 4        | 是用户的组ID，添加用户时如果不指定所属组，会建立和用户同名的组 |
  | 5        | 用户说明                                                     |
  | 6        | 用户家目录                                                   |
  | 7        | 登陆的shell                                                  |

### <font color=blue size=4>2. 用户密码文件：/etc/shadow</font>

- `/etc/shadow`：在这个文件中，每一行代表一个用户的信息，每一行用冒号分为9列，如下：

  ```sh
  panda:$pwd:  : 0 :99999: 7 :   :   :  
    ①     ②   ③  ④    ⑤     ⑥   ⑦   ⑧    ⑨
  ```

- 用户密码文件字段说明

  | 字段列号 | 说明                                                         |
  | -------- | ------------------------------------------------------------ |
  | 1        | 用户名                                                       |
  | 2        | 用户加密后的密码（SHA512）<br />在密码前加！！或*字符表示当前用户密码失效无法登陆 |
  | 3        | 更新密码的时间：格式是时间戳（距离的天数）                   |
  | 4        | 两次修改密码的时间间隔（和字段③相比）：不建议修改            |
  | 5        | 时间的有效期（和字段③相比）                                  |
  | 6        | 密码失效前的警告天数（和字段⑤相比）                          |
  | 7        | 密码到期后的宽限天数（和字段⑤相比），默认值是-1              |
  | 8        | 密码有保质时间，到期即失效                                   |
  | 9        | 保留                                                         |

### <font color=blue size=4>3. 组信息文件：/etc/grop</font>

- `/etc/grop`：被冒号分隔为4列

  ```sh
  panda:x:1000:panda
    ①   ②   ③    ④
  ```

- 组信息文件字段说明

  | 列   | 说明                                                         |
  | ---- | ------------------------------------------------------------ |
  | 1    | 组名                                                         |
  | 2    | 组密码位：不建议设置                                         |
  | 3    | 组ID：GID                                                    |
  | 4    | 此组中支持的其他用户，附加组是此组的用户<br />- 初始组：每个用户的初始组只有一个，一般是和用户同名的组为初始组，不建议修改初始组<br />- 附加组：每个用户可以有多个附加组，把用户加入其他组就是加入其他组的附加组 |

### <font color=blue size=4>4. ​组密码文件：不建议设置</font>

- `/etc/gshadow`：如果给用户设定了组管理员并设置的组密码，组密码就会保存在这个文件中，组管理员就可以利用这个密码管理用户组了，

  ```sh
  panda:!!:  :panda
    ①    ②  ③   ④
  ```

- 组密码文件字段说明

  | 列   | 说明 |
  | ---- | ---- |
  | 1    |      |
  | 2    |      |
  | 3    |      |
  | 4    |      |

### <font color=blue size=4>5. 用户家目录</font>

- 默认没新增一个用户，都为为这个用户新建一个同名文件夹作为这个用户的家目录

### <font color=blue size=4>6. 用户邮箱文件：/var/spool/mail</font>

- 为每一个登陆用户在/var/spool/mail下创建一个同名文件夹作为邮箱目录

### <font color=blue size=4>7. ​用户模板目录：/etc/skel</font>

- 默认新增用户都会给用户家目录中添加一些默认隐藏文件，这些文件就是从这个目录拷贝过去
- 这些模板文件主要记录用户的初始操作环境：是环境变量配置文件

## 5.3 用户管理

### <font color=blue size=4>1. 添加用户：useradd</font>

- **命令格式**

  ```sh
   useradd [选项] 用户名
  ```

- **选项说明**

  | 选项     | 说明                                                         |
  | -------- | ------------------------------------------------------------ |
  | -u UID   | **不建议指定**：手动指定用户UID                              |
  | -g 组名  | **不建议指定**：指定用户初始组，默认是用户同名的组           |
  | -G 组名  | 为用户添加附加组                                             |
  | -c 说明  | 为用户添加说明                                               |
  | -d 目录  | **不建议指定**：手动指定用户家目录路径，默认是和用户名同名的目录 |
  | -s shell | **不建议指定**：默认是：/bin/shell                           |

- **useradd的默认值**

  - /etc/default/useradd：配置了添加用户的相关默认信息

    ```sh
    # useradd defaults file
    GROUP=100
    HOME=/home
    INACTIVE=-1
    EXPIRE=
    SHELL=/bin/bash
    SKEL=/etc/skel
    CREATE_MAIL_SPOOL=yes
    ```

  - /etc/login.defs：配置了shadow-utils下的默认行为

    ```sh
    # 目录中存放邮箱的目录
    MAIL_DIR        /var/spool/mail
    
    
    PASS_MAX_DAYS   99999	# 密码可以使用的最大天数。
    PASS_MIN_DAYS   0		# 码更改之间允许的最小天数。
    PASS_MIN_LEN    5		# 最小可接受密码长度。
    PASS_WARN_AGE   7		# 密码过期前警告的天数。
    
    
    # 用户ID的最大值和最小值
    UID_MIN                  1000
    UID_MAX                 60000
    # System accounts
    SYS_UID_MIN               201
    SYS_UID_MAX               999
    
    
    # GID的最大值和最小值
    GID_MIN                  1000
    GID_MAX                 60000
    # System accounts
    SYS_GID_MIN               201
    SYS_GID_MAX               999
    
    
    # 删除用户时运行此命令
    #USERDEL_CMD    /usr/sbin/userdel_local
    
    # 默认应该为用户创建家目录
    CREATE_HOME     yes
    
    # The permission mask is initialized to this value. If not specified, 
    # the permission mask will be initialized to 022.
    UMASK           077
    
    # 是否运行删除不存在成员的用户组：删除用户时候删除组
    USERGROUPS_ENAB yes
    
    # 使用SHA512加密
    ENCRYPT_METHOD SHA512 
    ```

### <font color=blue size=4>2. 设置密码：passwd</font>

- **命令格式**：如果不带用户名，默认是修改当前用户的密码

  ```sh
  passwd [选项] [用户名]
  ```

- **选项说明**

  | 选项    | 说明                                   |
  | ------- | -------------------------------------- |
  | -l      | 暂时锁定用户，只能root用户可以用       |
  | -u      | 解锁用户，只能root用户可以用           |
  | --stdin | 可以将通过管道符输出的数据作为用户密码 |

- **扩展技巧**：通过修改密码的修改日期（/etc/shadow中的第三项）归零，保证新建用户登录就要修改密码

  ```sh
  chage -d 0 用户名
  ```

### <font color=blue size=4>3. 修改用户信息：usermod</font>

- **命令说明**：修改已添加的用户信息

  ```sh
  usermod [选项] 用户名
  ```

- **选项说明**

  | 选项        | 说明                                      |
  | ----------- | ----------------------------------------- |
  | -u UID      | **不建议指定**：修改用户的UID             |
  | -d 目录     | **不建议指定**：修改用户家目录            |
  | -c 用户说明 | **不建议指定**：修改用户说明              |
  | -g 组名     | **不建议指定**：修改用户初始组            |
  | -G 组名     | 修改用户附加组                            |
  | -s shell    | **不建议指定**：修改用户登录shell         |
  | -e 日期     | 修改用户失效日期：格式是“YYYY-MM-DD”      |
  | -L          | **不建议指定**：临时锁定用户  = passwd -l |
  | -U          | **不建议指定**：解锁用户 = passwd -u      |

### <font color=blue size=4>4. 删除用户：userdel</font>

- **删除命令**：默认删除用户不会删除用户家目录；选项-r表示删除用户的同时删除用户的家目录

  ```sh
  userdel -r 用户名
  ```

### <font color=blue size=4>5. 切换用户：su</font>

- **切换用户命令**：切换用户后，默认用户的环境变量不会被切换，-号表示连带环境变量一起切换

  ```sh
  su - 用户名
  ```

## 5.4 组管理

### <font color=blue size=4>1. 添加组：groupadd</font>

```sh
groupadd [-g 组ID] 组名 
```

### <font color=blue size=4>2. 删除组：groupdel</font>

```sh
# 如果组的初始用户存在，则不允许删除组
groupdel 组名
```

### <font color=blue size=4>3. 添加/删除用户到组：gpasswd</font>

- **添加用户到组**：改命令操作是用户的附加组，推荐使用该命令操作用户的组

  ```sh
  gpasswd [选项] 组名
  ```

- **选项说明**

  | 选项      | 说明           |
  | --------- | -------------- |
  | -a 用户名 | 把用户添加到组 |
  | -d 用户名 | 把用户从组删除 |

### <font color=blue size=4>4. 改变有效组：newgrp</font>

- **命令说明**：用户新建的文件默认的所属组是用户初始组，如果要修改新建文件的默认所属组则需要改变用户的有效组，修改当前用户的有效组

  ```sh
  newgrp 组名
  ```

# 第六章 权限管理

## 6.1 ACL权限











# 第七章 文件系统管理

## 6.1 硬盘与接口

 