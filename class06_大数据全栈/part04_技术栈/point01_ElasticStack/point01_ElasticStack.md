# å‰è¨€

æ•°æ®çš„åˆ†ç±»ï¼š

- ç»“æ„åŒ–æ•°æ®ï¼šå…³ç³»å‹è¡¨ä¸­ä¿å­˜çš„æ•°æ®ï¼Œç”±ç‰¹å®šçš„ç»“æ„ç»„ç»‡å’Œç®¡ç†æ•°æ®
- åŠç»“æ„åŒ–æ•°æ®ï¼šå°†æ•°æ®çš„ç»“æ„å’Œæ•°æ®å†…å®¹æ··åˆåœ¨ä¸€èµ·ï¼Œå¦‚xml/html
- éç»“æ„åŒ–æ•°æ®ï¼šæ— æ³•ç”¨ç‰¹å®šç»“æ„è¡¨ç¤ºçš„æ•°æ®ï¼Œå¦‚æ—¥å¿—ç­‰ç­‰ï¼Œä¸€èˆ¬æ˜¯key:valueæ ¼å¼

# ç¬¬ä¸€ç«  ElasticStack

## 1.1 ELK

ELKæ˜¯Elasticsearchã€Kibanaã€Logstashä¸‰ä¸ªæŠ€æœ¯çš„ç»„åˆï¼Œç»„åˆä½¿ç”¨å¯ä»¥è§£å†³å¤§éƒ¨åˆ†è½¯ä»¶å¼€å‘ä¸­çš„æ—¥å¿—åˆ†æä¸å¤„ç†å·¥ä½œï¼Œèƒ½å¤Ÿå®‰å…¨å¯é åœ°è·å–ä»»ä½•æ¥æºã€ä»»ä½•æ ¼å¼çš„æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¤Ÿå®æ—¶åœ°å¯¹æ•°æ®è¿›è¡Œæœç´¢ã€åˆ†æå’Œå¯è§†åŒ–ï¼›å…¶ä¸­ï¼ŒLogstashè´Ÿè´£æ•°æ®çš„æ”¶é›†ï¼ŒKibanaè´Ÿè´£ç»“æœæ•°æ®çš„å¯è§†åŒ–å±•ç°ï¼ŒElasticsearchä½œä¸ºæ ¸å¿ƒéƒ¨åˆ†ç”¨äºæ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ä»¥åŠç´¢å¼•ã€‚

## 1.2 ElasticStack

ElasticStackè¡¨ç¤ºESæŠ€æœ¯æ ˆï¼Œåœ¨ELKçš„åŸºç¡€è®¾åŸºç¡€ä¸Šæ–°å¢äº†BeatsæŠ€æœ¯æˆå‘˜ï¼Œæ‰€ä»¥ELKé‡æ–°æ”¹åä¸ºElasticStackï¼›ElasticStackçš„å·¥ä½œæµç¨‹:

1. Beatså°†é‡‡é›†çš„å„ç§æ•°æ®å‘é€åˆ°ElasticSearchæˆ–äº¤ç»™LogStashè¿›è¡Œæ•°æ®å¤„ç†
2. Logstashçš„ä¸»è¦ä½œç”¨æ˜¯åšæ•°æ®å¤„ç†å·¥ä½œ
3. ElasticSearchä¸»è¦æ˜¯ä¿å­˜æ•°æ®
4. æœ€ç»ˆKibanaè¿æ¥ElasticSearchå°†æ•°æ®å¯è§†åŒ–å±•ç¤º

## 1.3 ElasticSearchæŠ€æœ¯æ ˆç®€ä»‹

[![GfcENQ.png](https://s1.ax1x.com/2020/04/08/GfcENQ.png)](https://imgtu.com/i/GfcENQ)

1. **ElasticSearch**ï¼šæ˜¯ä½¿ç”¨Javaè¯­è¨€ç¼–å†™çš„å¹¶ä¸”åŸºäºLuceneç¼–å†™çš„æœç´¢å¼•æ“æ¡†æ¶ï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯ï¼šåˆ†å¸ƒå¼ï¼Œé›¶é…ç½®ï¼Œè‡ªåŠ¨å‘ç°ï¼Œç´¢å¼•è‡ªåŠ¨åˆ†ç‰‡ï¼Œç´¢å¼•å‰¯æœ¬æœºåˆ¶ï¼ŒRESTfulé£æ ¼æ¥å£ï¼Œå¤šæ•°æ®æºï¼Œè‡ªåŠ¨æœç´¢è´Ÿè½½ç­‰ã€‚æ ¸å¿ƒæŠ€æœ¯æ˜¯å€’æ’ç´¢å¼•ï¼šåœ¨ElasticSrearchä¸­æ•°æ®å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼ŒElasticSearchä¼šæ ¹æ®ç´¢å¼•ä¸­çš„æ•°æ®è¿›è¡Œåˆ†è¯ä¿å­˜åœ¨åˆ†è¯åº“ä¸­ï¼›å½“éœ€è¦æ£€ç´¢æ•°æ®æ—¶å€™ï¼Œé¦–å…ˆä¼šæ ¹æ®æ£€ç´¢å…³é”®å­—åœ¨åˆ†è¯åº“ä¸­æ£€ç´¢å‡ºç´¢å¼•IDï¼Œå†æ ¹æ®æ£€ç´¢çš„ç´¢å¼•IDå»ç´¢å¼•ä¸­ç›´æ¥æŸ¥æ‰¾å¯¹åº”çš„æ•°æ®ï¼›
   - Luceneï¼šæœ¬èº«å°±æ˜¯ä¸€ä¸ªæœç´¢å¼•æ“çš„åº•å±‚ï¼›
   - Slorï¼šæŸ¥è¯¢æ­»æ•°æ®æ—¶å€™ï¼Œé€Ÿåº¦ç›¸å¯¹ESè€Œè¨€Sloræ›´å¿«ä¸€äº›ï¼Œå¦‚æœæ•°æ®å®æ—¶æ”¹å˜çš„ï¼ŒSloré€Ÿåº¦ä¼šå—å¾ˆå¤§å½±å“ï¼›ESé›†ç¾¤æ›´å®¹æ˜“æ­å»ºï¼›
   - åˆ†å¸ƒå¼ï¼šä¸»è¦æ˜¯ä½“ç°åœ¨æ¨ªå‘æ‰©å±•èƒ½åŠ›ï¼›
2. **LogStash**ï¼šåŸºäºJavaï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ç”¨äºæ”¶é›†ã€åˆ†æå’Œå‚¨å­˜æ—¥å¿—çš„å·¥å…·
3. **Kibana**ï¼šåŸºäºNodeï¼ŒKibnaå¯ä»¥ä¸ºLogStashå’ŒElasticSearchæä¾›å‹å¥½çš„webç•Œé¢ï¼Œå¯ä»¥æ±‡æ€»ï¼Œåˆ†æï¼Œæœç´¢é‡è¦æ•°æ®
4. **Beats**ï¼šæ˜¯elasticå…¬å¸å¼€æºçš„ä¸€æ¬¾é‡‡é›†ç³»ç»Ÿç›‘æ§æ•°æ®çš„agentï¼Œæ˜¯åœ¨è¢«ç›‘æ§çš„æœåŠ¡å™¨ä¸Šä»¥å®¢æˆ·ç«¯çš„å½¢å¼è¿è¡Œçš„æ•°æ®æ”¶é›†å™¨ç»Ÿç§°ï¼Œå¯ä»¥ç›´æ¥æŠŠæ•°æ®å‘é€ç»™ElasticSearchæˆ–è€…é€šè¿‡LogStashå‘é€ç»™ElasticSearchï¼Œç„¶åè¿›è¡Œåç»­çš„æ•°æ®åˆ†ææ´»åŠ¨ã€‚Beatä¸»è¦çš„ç»„æˆï¼š
   - **Packetbeat**ï¼šæ˜¯ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…åˆ†æå™¨ï¼Œç”¨äºç›‘æ§ã€æ”¶é›†ç½‘ç»œæµé‡ä¿¡æ¯ï¼ŒPacketbeatå—…æ¢æœåŠ¡å™¨ç›´æ¥çš„æµé‡ï¼Œè§£æåº”ç”¨å±‚åè®®ï¼Œå¹¶å…³è”åˆ°æ¶ˆæ¯çš„å¤„ç†ï¼Œæ”¯æŒICMPï¼ˆIPV4 and IPV6ï¼‰ã€DNSã€HTTPã€MySqlã€Redisã€PostgrpreSQLã€MongoDBç­‰åè®®
   - **Filebeat**ï¼šç”¨äºç›‘æ§æ”¶é›†æœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶ï¼Œä»¥å–ä»£logstash forwarder
   - **Metricbeat**ï¼šå¯å®šæœŸè·å–å¤–éƒ¨ç³»ç»Ÿç›‘æ§æŒ‡æ ‡ä¿¡æ¯ï¼Œå…¶å¯ä»¥ç›‘æ§æ”¶é›†Apacheã€HAProxyã€MongoDBã€MySqlã€Nginxã€Redisã€PostgrpreSQLã€Redisã€Systemã€ZooKeeperç­‰æœåŠ¡
   - **Winlogbeat**ï¼šç”¨äºç›‘æ§æ”¶é›†Windowsçš„æ—¥å¿—ä¿¡æ¯ã€‚

# ç¬¬äºŒç«  ElasticSearchå®‰è£…

## 2.1 ElasticSearchç‰ˆæœ¬è¯´æ˜

ç‰ˆæœ¬è¯´æ˜ï¼šElasticSearchå‘å±•éå¸¸å¿«ï¼Œåœ¨5.0ä»¥å‰ELKå„ä¸ªç‰ˆæœ¬éƒ½ä¸ç»Ÿä¸€ï¼Œæ‰€ä»¥åœ¨ELK5.0ä»¥åElasticstaticæŠ€æœ¯æ ˆçš„ç‰ˆæœ¬éƒ½ç»Ÿä¸€ä¸ºä¸€ä¸ªç‰ˆæœ¬å·

- ElasticSearchä¸‹è½½åœ°å€ï¼šhttps://www.elastic.co/cn/downloads/elasticsearch

- Kibanaä¸‹è½½åœ°å€ï¼šhttps://www.elastic.co/cn/downloads/kibana
- LogStashä¸‹è½½åœ°å€ï¼š
- Beatsä¸‹è½½åœ°å€ï¼š

## 2.2 ElasticSearchå®‰è£…

### 1. Linuxç³»ç»Ÿå®‰è£…

- åˆ é™¤CentOSä¸­é¢„å®‰è£…çš„Java

  ```sh
  rpm -qa | grep java
  rpm -e --nodeps xxx
  ```

- å®‰è£…ElasticSearchå¯¹åº”çš„JDK

  ```sh
  export JAVA_HOME=/opt/jdk
  export PATH=$JAVA_HOME/bin:$PATH
  export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar 
  ```

- åˆ›å»ºElasticSearchç”¨æˆ·ï¼šå› ä¸ºElasticSearché»˜è®¤ä¸æ”¯æŒrootç”¨äºè¿è¡Œï¼Œæ‰€ä»¥ElasticSearchéœ€è¦å•ç‹¬åˆ›å»ºç”¨æˆ·

  ```sh
  useradd elsearch
  ```

- æ–°å»ºElasticSearchçš„å®‰è£…ç›®å½•ï¼Œå®‰è£…ç›®å½•è‡ªå®šä¹‰ï¼Œè¿™é‡Œæ˜¯å®‰è£…åœ¨optä¸­æ˜¯searchç›®å½•ä¸­ï¼Œå¹¶ä¸Šä¼ ElasticSearchçš„å®‰è£…åŒ…å¹¶è§£å‹åˆ°searchç›®å½•ä¸­

  ```sh
  cd /opt
  mkdir search
  chown elsearch:elsearch search/ -R
  ```

- ElasticSearché…ç½®æ–‡ä»¶è¯´æ˜ï¼šåœ¨/opt/search/config/ç›®å½•ä¸­çš„ç›¸å…³æ–‡ä»¶

  1. **elasticsearch.yml**ï¼šElasticSearchçš„å¯åŠ¨é…ç½®æ–‡ä»¶

     ```yml
     # ---------------------------------- Cluster -----------------------------------
     # é›†ç¾¤åç§°
     #cluster.name: my-application
     # ------------------------------------ Node ------------------------------------
     # èŠ‚ç‚¹åç§°:
     node.name: node-1
     # èŠ‚ç‚¹è‡ªå®šä¹‰å±æ€§:
     #node.attr.rack: r1
     # ----------------------------------- Paths ------------------------------------
     # å­˜å‚¨æ•°æ®çš„ç›®å½•,å¤šä¸ªè·¯å¾„ç”¨é€—å·åˆ†éš”:
     #path.data: /path/to/data
     # æ—¥å¿—æ–‡ä»¶ç›®å½•:
     #path.logs: /path/to/logs
     # ----------------------------------- Memory -----------------------------------
     # å¯åŠ¨æ—¶æ˜¯å¦é”å®šå†…å­˜:
     #bootstrap.memory_lock: true
     # ---------------------------------- Network -----------------------------------
     # å°†ç»‘å®šåœ°å€è®¾ç½®ä¸ºç‰¹å®šçš„IP (IPv4æˆ–IPv6) 0 ä»»æ„ç«¯å£å¯ä»¥è®¿é—®
     network.host: 0.0.0.0
     # ä¸ºHTTPè®¾ç½®è‡ªå®šä¹‰ç«¯å£:
     http.port: 9200
     # --------------------------------- Discovery ----------------------------------
     #å½“è¿™ä¸ªèŠ‚ç‚¹å¯åŠ¨æ—¶ï¼Œä¼ é€’ä¸€ä¸ªåˆå§‹çš„ä¸»æœºåˆ—è¡¨æ¥æ‰§è¡Œå‘ç°: é»˜è®¤çš„ä¸»æœºåˆ—è¡¨æ˜¯["127.0.0.1"ï¼Œ"[::1]"]
     #discovery.seed_hosts: ["host1", "host2"]
     # ä½¿ç”¨ä¸»èŠ‚ç‚¹çš„åˆå§‹é›†åˆå¼•å¯¼é›†ç¾¤:
     cluster.initial_master_nodes: ["node-1"]
     # ---------------------------------- Gateway -----------------------------------
     # åœ¨æ•´ä¸ªé›†ç¾¤é‡æ–°å¯åŠ¨åé˜»å¡åˆå§‹æ¢å¤ï¼Œç›´åˆ°Nä¸ªèŠ‚ç‚¹å¯åŠ¨:
     #gateway.recover_after_nodes: 3
     # ---------------------------------- Various -----------------------------------
     # åˆ é™¤ç´¢å¼•æ—¶è¦æ±‚æ˜¾å¼åç§°:
     #action.destructive_requires_name: true
     ```

  2. **jvm.options**ï¼šElasticSearchæ˜¯åŸºäºJavaå¼€å‘ï¼Œjvm.optionsç”¨äºè®¾ç½®ElasticSearchè¿è¡Œæ—¶jvmç¯å¢ƒç›¸å…³é…ç½®ï¼›ElasticSearchä¸­çš„hosté…ç½®ä¸æ˜¯localhostæˆ–127.0.0.1ä¼šè¢«è®¤ä¸ºæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œä¼šå¤šElasticSearchå¯åŠ¨è¦æ±‚æ¯”è¾ƒé«˜ï¼›

     ```properties
     # Xms è¡¨ç¤ºæ€»çš„å †ç©ºé—´çš„åˆå§‹å¤§å°
     # Xmx è¡¨ç¤ºå †ç©ºé—´çš„æœ€å¤§å¤§å°
     -Xms128m
     -Xmx128m
     ```

  3. log4j2.properties

  4. role_mapping.yml

  5. roles.yml

- é…ç½®ç³»ç»Ÿçš„å†…å­˜ä¸€ä¸ªè¿›ç¨‹åœ¨VMASï¼ˆè™šæ‹Ÿå†…å­˜ï¼‰åˆ›å»ºå†…å­˜æ˜ å°„çš„æœ€å¤§æ•°é‡ï¼š**éœ€è¦ä½¿ç”¨rootç”¨æˆ·è¿›è¡Œæ“ä½œ**

  ```sh
  vim /etc/sysctl.conf		# ç¼–è¾‘é…ç½®æ–‡ä»¶,ä¿®æ”¹æ­¤æ–‡ä»¶éœ€è¦é‡å¯LinuxæœåŠ¡å™¨
  vm.max_map_count=655360		# ä¿®æ”¹å†…å­˜æœ€å¤§æ˜ å°„æ•°é‡
  sysctl -p 					# æŸ¥çœ‹é…ç½®åçš„ä¿¡æ¯
  ```

- ä¿®æ”¹æœ€å¤§æ–‡ä»¶æè¿°ä»¥æ»¡è¶³ELasticSearchï¼šmax file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]ï¼›\*å·çš„ä½ç½®æ ‡ç¤ºæ”¯æŒçš„ç”¨æˆ·åç§°ï¼Œ\*å·åŒ¹é…æ‰€æœ‰ç”¨æˆ·

  ```sh
  vim /etc/security/limits.conf
  # >>>>è¿½åŠ  * å·è¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·
  * soft nofile 65536
  * hard nofile 131072
  * soft nproc 2048
  * hard nproc 4096
  ```

- é»˜è®¤è¿›ç¨‹ä¸­çš„çº¿ç¨‹æ•°2014å¤ªä½ æœ€å°‘æ˜¯4096ï¼šmax number of threads [3756] for user [elsearch] is too low, increase to at least [4096]

  ```sh
  vim /etc/security/limits.d/20-nproc.conf
  # >>>>ä¿®æ”¹
  *          soft    nproc     4096
  ```

- å¼€å¯ElasticSearchç«¯å£ï¼š9200

  ```sh
  firewall-cmd --zone=public --add-port=9200/tcp --permanent 
  firewall-cmd --reload
  ```

- ä¿®æ”¹ElasticSearchçš„å®‰è£…çš„ç”¨æˆ·æ‰€å±å¹¶åˆ‡æ¢åˆ°elsearchç”¨æˆ·ï¼šåœ¨å¯åŠ¨åElasticSearchç”Ÿæˆçš„æ—¥å¿—ç›¸å…³æ–‡ä»¶æ‰€å±ä¹Ÿæ˜¯rootç”¨æˆ·ï¼Œéœ€è¦å°†è¿™äº›æ–‡ä»¶ä¹Ÿä¿®æ”¹ä¸ºæ–°å»ºçš„elsearchï¼ˆérootç”¨æˆ·ï¼‰çš„æ‰€å±ï¼›

  ```sh
  chown elsearch:elsearch -R /opt/search
  su - elsearch
  ```

- ç”¨elsearchï¼ˆérootç”¨æˆ·ï¼‰ç”¨æˆ·å¯åŠ¨ElasticSearchæœåŠ¡

  ```sh
  cd /bin
  ./elasticsearch		# å‰å°å¯åŠ¨
  ./elasticsearch &  	# åå°å¯åŠ¨
  ```

### 2. Windowsç³»ç»Ÿå®‰è£…

### 3. Dockerå®‰è£…

- è®¾ç½®

  ```sh
  vim etc/sysctl.conf
  vm.max_map_count=131072
  ```

- ä¸‹è½½ElasticSearch

  ```sh
  docker pull elasticsearch:7.6.0
  ```

- è¿è¡Œé•œåƒå¯åŠ¨å®¹å™¨

  ```sh
  mkdir -p /docker/elstatic/search/plugins
  mkdir -p /docker/elstatic/search/data
  ```

  ```sh
  chmod 777 /docker/elstatic/search/data
  ```

  ```sh
  docker run -p 9200:9200 -p 9300:9300 --name elasticsearch \
  -e "ES_JAVA_OPTS=-Xms512m -Xmx512m" \
  -e "discovery.type=single-node" \
  -e "cluster.name=elasticsearch" \
  -v /docker/elstatic/search/plugins:/usr/share/elasticsearch/plugins \
  -v /docker/elstatic/search/data:/usr/share/elasticsearch/data \
  -d elasticsearch:7.6.0
  
  
  docker run -p 9200:9200 -p 9300:9300 --name elasticsearch -e "ES_JAVA_OPTS=-Xms512m -Xmx512m" -e "discovery.type=single-node" -e "cluster.name=elasticsearch" -v D:/panda_docker_files/search/plugins:/usr/share/elasticsearch/plugins -v D:/panda_docker_files/search/data:/usr/share/elasticsearch/data -d elasticsearch:7.6.0
  ```

- æµ‹è¯•å®‰è£…ï¼šhttp://120.27.22.124:9200/

- å®‰è£…ï¼šelstaticstarch-head

  - dockerï¼šéœ€è¦å¤„ç†æœåŠ¡è·¨åŸŸè®¿é—®é…ç½®

    ```sh
    docker pull mobz/elasticsearch-head:5
    
    docker run -d --name es_head -p 9100:9100 mobz/elasticsearch-head:5
    ```

  - Githubï¼šChromeæ’ä»¶çš„ä½¿ç”¨æ— éœ€å¤„ç†è·¨åŸŸ

    ```sh
    git clone https://github.com/mobz/elasticsearch-head.git
    ```

## 2.3 IKåˆ†è¯å™¨



## 2.4 Kibanaå®‰è£…

### 1. Linuxç³»ç»Ÿå®‰è£…

- æ–°å»ºKibanaå®‰è£…ç›®å½•ï¼š/opt/kibana

- å°†Kibanaå®‰è£…åŒ…è§£å‹åˆ°/opt/kibanaç›®å½•ä¸­ï¼šKibanaçš„ç‰ˆæœ¬å¿…é¡»å’ŒElasticSearchç‰ˆæœ¬ç›¸åŒ

- ä¿®æ”¹Kibanaé…ç½®æ–‡ä»¶ï¼š/opt/kibana/config/kibana.yml

  ```yml
  # Kibana æœåŠ¡å¯åŠ¨ç«¯å£
  server.port: 5601
  
  # æŒ‡å®šKibanaæœåŠ¡å™¨è¦ç»‘å®šåˆ°çš„åœ°å€
  server.host: "192.168.57.129"
  
  #server.basePath: ""
  
  #server.rewriteBasePath: false
  
  # ä¼ å…¥æœåŠ¡å™¨è¯·æ±‚çš„æœ€å¤§è´Ÿè½½å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½)
  #server.maxPayloadBytes: 1048576
  
  # KibanaæœåŠ¡å™¨çš„åå­—ã€‚å®ƒç”¨äºæ˜¾ç¤ºç›®çš„
  #server.name: "your-hostname"
  
  # ç”¨äºæ‰€æœ‰æŸ¥è¯¢çš„Elasticsearchå®ä¾‹çš„url
  elasticsearch.hosts: ["http://192.168.57.129:9200"]
  
  # å½“è¿™ä¸ªè®¾ç½®çš„å€¼ä¸ºçœŸæ—¶ï¼ŒKibanaä½¿ç”¨server.hostä¸­æŒ‡å®šçš„ä¸»æœºå
  #elasticsearch.preserveHost: true
  
  #kibana.index: ".kibana"
  
  # è¦åŠ è½½çš„é»˜è®¤åº”ç”¨ç¨‹åº.
  #kibana.defaultAppId: "home"
  
  
  #elasticsearch.username: "kibana"
  #elasticsearch.password: "pass"
  
  #server.ssl.enabled: false
  #server.ssl.certificate: /path/to/your/server.crt
  #server.ssl.key: /path/to/your/server.key
  
  #elasticsearch.ssl.certificate: /path/to/your/client.crt
  #elasticsearch.ssl.key: /path/to/your/client.key
  
  
  #elasticsearch.ssl.certificateAuthorities: [ "/path/to/your/CA.pem" ]
  
  #elasticsearch.ssl.verificationMode: full
  
  #elasticsearch.pingTimeout: 1500
  
  #elasticsearch.requestTimeout: 30000
  
  #elasticsearch.requestHeadersWhitelist: [ authorization ]
  
  #elasticsearch.customHeaders: {}
  
  #elasticsearch.shardTimeout: 30000
  
  #elasticsearch.startupTimeout: 5000
  
  #elasticsearch.logQueries: false
  
  #pid.file: /var/run/kibana.pid
  
  #logging.dest: stdout
  
  #logging.silent: false
  
  #logging.quiet: false
  
  #logging.verbose: false
  
  #ops.interval: 5000
  
  i18n.locale: "zh-CN"
  ```

- å¼€å¯kibanaæœåŠ¡è¿è¡Œç«¯å£ï¼š5601

  ```sh
  firewall-cmd --zone=public --add-port=5601/tcp --permanent 
  firewall-cmd --reload
  ```

- åˆ‡æ¢åˆ°érootç”¨æˆ·,å¹¶å°†kibanaå®‰è£…ç›®å½•æŒ‡å®šä¸ºå½“å‰ç”¨æˆ·æ‰€å±

  ```sh
  chown elsearch:elsearch -R /opt/kibana
  su - elsearch
  /opt/kibana/kibana &
  ```
  
- dockerå®‰è£…

  ```sh
  ```

  

## 2.5 LogStashå®‰è£…

## 2.6 Beats - å®‰è£…

## 2.7 Chrome Headæ’ä»¶å®‰è£…

- GItæºç åœ°å€ï¼šhttps://github.com/mobz/elasticsearch-head
- æ‰“å¼€ä¸‹è½½åœ°å€æ‰¾åˆ°es-head.crxæ–‡ä»¶ï¼š/elasticsearch-head/blob/master/crx/es-head.crx
- æ–‡ä»¶åç¼€å".crx"æ”¹ä¸ºâ€œ.rarâ€è§£å‹åˆ°æ–‡ä»¶å¤¹ä¸­
- Chromeâ€œåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºâ€æŒ‰é’®åŠ å…¥æ–‡ä»¶å¤¹ã€‚

## 2.8 ESåŸºç¡€çŸ¥è¯†

1. ESæ˜¯åˆ†å¸ƒå¼ï¼Œæ”¯æŒRESTFulæœç´¢å’Œåˆ†æçš„ï¼šèµ„æºæ ¹æ®è¯·æ±‚çŠ¶æ€çš„ä¸åŒè€Œäº§ç”Ÿä¸åŒçš„å“åº”ï¼›
2. å€’æ’ç´¢å¼•ï¼šESæ˜¯é¢å‘æ–‡æ¡£å‹æ•°æ®åº“ï¼Œä¸€æ¡æ•°æ®å°±æ˜¯è¡¨ç¤ºä¸€ä¸ªæ–‡æ¡£ï¼›å¯ä»¥ä¸å…³ç³»æ€§æ•°æ®åº“åšå¯¹æ¯”ï¼šesä¸­çš„ç´¢å¼•åœ¨å…³ç³»æ€§æ•°æ®åº“ä¸­è¡¨ç¤ºä¸ºä¸€ä¸ªdatabaseï¼Œesä¸­çš„typeç›¸å½“äºè¡¨ï¼Œä¸€ä¸ªæ–‡æ¡£ï¼ˆjsonæ ¼å¼çš„å­—ç¬¦ä¸²ï¼‰è¡¨ç¤ºä¸€è¡Œæ•°æ®ï¼Œæ–‡æ¡£ä¸­çš„Fieldï¼ˆjsonä¸­çš„keyï¼‰è¡¨ç¤ºåˆ—åï¼›esä¸­ä¸ºäº†åšåˆ°å¿«é€Ÿæ£€ç´¢ï¼Œä½¿ç”¨å€’æ’ç´¢å¼•åŠ é€Ÿæ£€ç´¢ï¼šå°†æ–‡æ¡£ä¸­çš„å†…å®¹ä½œä¸ºæŸ¥è¯¢çš„keyï¼Œè€Œå°†æ–‡æ¡£IDä½œä¸ºå¯¹åº”çš„valueï¼›åœ¨æ–°ç‰ˆesä¸­typeè¢«æ·˜æ±°äº†ï¼›

# ç¬¬ä¸‰ç«  ElasticSearchåŸºç¡€

## 3.1 ESåŸºæœ¬æ¦‚å¿µ

### 1ã€é›†ç¾¤

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åŒ…å«å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å±äºå“ªä¸ªé›†ç¾¤æ˜¯é€šè¿‡ä¸€ä¸ªé…ç½®ï¼ˆé›†ç¾¤åç§°ï¼Œé»˜è®¤æ˜¯elasticsearchï¼‰æ¥å†³å®šçš„ï¼Œå¯¹äºä¸­å°å‹åº”ç”¨æ¥è¯´ï¼Œåˆšå¼€å§‹ä¸€ä¸ªé›†ç¾¤å°±ä¸€ä¸ªèŠ‚ç‚¹å¾ˆæ­£å¸¸ã€‚é›†ç¾¤çš„ç›®çš„ä¸ºäº†æä¾›é«˜å¯ç”¨å’Œæµ·é‡æ•°æ®çš„å­˜å‚¨ä»¥åŠæ›´å¿«çš„è·¨èŠ‚ç‚¹æŸ¥è¯¢èƒ½åŠ›ã€‚

### 2ã€èŠ‚ç‚¹ 

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¹Ÿæœ‰ä¸€ä¸ªåç§°ï¼ˆé»˜è®¤æ˜¯éšæœºåˆ†é…çš„ï¼‰ï¼ŒèŠ‚ç‚¹åç§°å¾ˆé‡è¦ï¼ˆåœ¨æ‰§è¡Œè¿ç»´ç®¡ç†æ“ä½œçš„æ—¶å€™ï¼‰ï¼Œé»˜è®¤èŠ‚ç‚¹ä¼šå»åŠ å…¥ä¸€ä¸ªåç§°ä¸ºâ€œelasticsearchâ€çš„é›†ç¾¤ï¼Œå¦‚æœç›´æ¥å¯åŠ¨ä¸€å †èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šè‡ªåŠ¨ç»„æˆä¸€ä¸ªelasticsearché›†ç¾¤ï¼Œå½“ç„¶ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥ç»„æˆä¸€ä¸ªelasticsearché›†ç¾¤

### 3ã€å€’æ’ç´¢å¼•

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¼ ç»Ÿçš„ç´¢å¼•æ–¹å¼æ˜¯å°†å­—æ®µå†…å®¹å­˜å‚¨ä¸ºç´¢å¼•ç»“æ„çš„æ•°æ®ï¼Œæ£€ç´¢æ—¶å€™æ ¹æ®å†…å®¹å…ˆæ£€ç´¢ç´¢å¼•ï¼Œåœ¨æ ¹æ®ç´¢å¼•æŸ¥è¯¢åˆ°æ•°æ®ï¼›åœ¨ElasticSearchä¸­ä½¿ç”¨å€’æ’ç´¢å¼•ï¼šå…¶åŸºæœ¬åŸç†æ˜¯è®²å­—æ®µä¸­å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œå°†åˆ†è¯ç»“æœå­˜å‚¨åœ¨åˆ†è¯åº“ä¸­ï¼Œå¹¶è®°å½•è¿™äº›åˆ†è¯å¯¹åº”çš„è®°å½•IDï¼Œæ£€ç´¢æ—¶å€™å°†æ£€ç´¢å…³é”®å­—è¿›è¡Œåˆ†è¯ååœ¨åˆ†è¯åº“ä¸­è¿›è¡ŒåŒ¹é…ï¼Œç„¶åå°†åŒ¹é…çš„åˆ†è¯å¯¹åº”çš„è®°å½•IDè¿›è¡Œè¿”å›ï¼Œæœ€åæ ¹æ®æ£€ç´¢å‡ºçš„è®°å½•IDæ£€ç´¢å‡ºæ•°æ®ï¼›

### 4ã€ç´¢å¼•

- ç´¢å¼•æ˜¯ElasticSearchå¯¹æ•°æ®çš„é€»è¾‘å­˜å‚¨ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åˆ†ä¸ºæ›´å°çš„éƒ¨åˆ†

- å¯ä»¥æŠŠç´¢å¼•çœ‹æˆå…³ç³»å‹æ•°æ®åº“çš„è¡¨ï¼Œç´¢å¼•çš„ç»“æ„æ˜¯ä¸ºå¿«é€Ÿæœ‰æ•ˆçš„å…¨æ–‡æ£€ç´¢å‡†å¤‡çš„ï¼Œç‰¹åˆ«æ˜¯å®ƒä¸å­˜å‚¨åŸå§‹å€¼

- ElasticSearchå¯ä»¥æŠŠç´¢å¼•å­˜æ”¾åœ¨ä¸€å°æœºå™¨æˆ–è€…åˆ†æ•£åœ¨å¤šæ€æœåŠ¡å™¨ä¸Šï¼Œæ¯ä¸ªç´¢å¼•æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ï¼ˆshardï¼‰ï¼Œæ¯ä¸ªåˆ†ç‰‡å¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆreplicaï¼‰ã€‚

- ESæœåŠ¡ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªç´¢å¼•

  æ¯ä¸€ä¸ªç´¢å¼•é»˜è®¤è¢«åˆ†ä¸º5ç‰‡å­˜å‚¨

  æ¯ä¸ªåˆ†ç‰‡éƒ½ä¼šå­˜åœ¨è‡³å°‘ä¸€ä¸ªå¤‡ä»½åˆ†ç‰‡

  å¤‡ä»½åˆ†ç‰‡é»˜è®¤ä¸ä¼šå¸®åŠ©æ£€ç´¢æ•°æ®ï¼Œå½“ESå‹åŠ›ç‰¹åˆ«å¤§æ—¶å€™ï¼Œå¤‡ä»½åˆ†ç‰‡æ‰ä¼šæ£€ç´¢æ•°æ®

  å¤‡ä»½çš„åˆ†ç‰‡å¿…é¡»æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸­

### 5ã€åˆ†ç‰‡

### 6ã€å‰¯æœ¬

### 7ã€æ–‡æ¡£

- å­˜å‚¨åœ¨Electicsearchä¸­çš„ä¸»è¦å®ä½“å«æ–‡æ¡£ï¼ˆdocumentï¼‰ï¼Œç”¨å…³ç³»å‹æ•°æ®åº“ç±»æ¯”çš„è¯ï¼Œä¸€ä¸ªæ–‡æ¡£ç›¸å½“äºæ•°æ®è¡¨ä¸­çš„ä¸€è¡Œè®°å½•ã€‚
- ElasticSearchå’ŒMongoDBä¸­çš„æ–‡æ¡£ç›¸ä¼¼ï¼Œéƒ½å¯ä»¥æœ‰ä¸åŒçš„ç»“æ„ï¼Œä½†åœ¨ElasticSearchä¸­ï¼Œç›¸åŒå­—æ®µå¿…é¡»æœ‰ç›¸åŒçš„ç±»å‹ã€‚
- æ–‡æ¡£ç”±å¤šä¸ªå­—æ®µç»„æˆï¼Œæ¯ä¸ªå­—æ®µå¯ä»¥å¤šæ¬¡çš„å‡ºç°åœ¨åŒä¸€æ–‡æ¡£ä¸­ï¼Œè¿™ç§å­—æ®µç§°ä¸º**å¤šå€¼å­—æ®µ**ï¼Œ
- æ¯ä¸ªå­—æ®µçš„ç±»å‹å¯ä»¥æ˜¯æ–‡æœ¬ã€æ•°å€¼ã€æ—¥æœŸç­‰ï¼›å­—æ®µç±»å‹ä¹Ÿå¯ä»¥æ˜¯å¤æ‚ç±»å‹ï¼Œä¸€ä¸ªå­—æ®µå¯ä»¥åŒ…å«å…¶ä»–å­æ–‡æ¡£æˆ–æ•°ç»„ï¼›

### 8ã€ç±»å‹

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;èµ·åˆï¼Œæˆ‘ä»¬è¯´"ç´¢å¼•"å’Œå…³ç³»æ•°æ®åº“çš„â€œåº“â€æ˜¯ç›¸ä¼¼çš„ï¼Œâ€œç±»å‹â€å’Œâ€œè¡¨â€æ˜¯å¯¹ç­‰çš„ã€‚è¿™æ˜¯ä¸€ä¸ªä¸æ­£ç¡®çš„å¯¹æ¯”ï¼Œå¯¼è‡´äº†ä¸æ­£ç¡®çš„å‡è®¾ã€‚åœ¨å…³ç³»å‹æ•°æ®åº“é‡Œ,"è¡¨"æ˜¯ç›¸äº’ç‹¬ç«‹çš„,ä¸€ä¸ªâ€œè¡¨â€é‡Œçš„åˆ—å’Œå¦å¤–ä¸€ä¸ªâ€œè¡¨â€çš„åŒååˆ—æ²¡æœ‰å…³ç³»ï¼Œäº’ä¸å½±å“ã€‚ä½†åœ¨ä¸€ä¸ªElasticsearchç´¢å¼•é‡Œï¼Œåœ¨ç±»å‹é‡Œå­—æ®µä¸æ˜¯è¿™æ ·çš„ï¼Œæ‰€æœ‰ä¸åŒç±»å‹çš„åŒåå­—æ®µå†…éƒ¨ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªluceneå­—æ®µå­˜å‚¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼šuserç±»å‹çš„user_nameå­—æ®µå’Œtweetç±»å‹çš„user_nameå­—æ®µæ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªå­—æ®µé‡Œçš„ï¼Œä¸¤ä¸ªç±»å‹é‡Œçš„user_nameå¿…é¡»æœ‰ä¸€æ ·çš„å­—æ®µå®šä¹‰ã€‚æœ€å,åœ¨åŒä¸€ä¸ªç´¢å¼•ä¸­ï¼Œå­˜å‚¨ä»…æœ‰å°éƒ¨åˆ†å­—æ®µç›¸åŒæˆ–è€…å…¨éƒ¨å­—æ®µéƒ½ä¸ç›¸åŒçš„æ–‡æ¡£ï¼Œä¼šå¯¼è‡´æ•°æ®ç¨€ç–ï¼Œå½±å“Luceneæœ‰æ•ˆå‹ç¼©æ•°æ®çš„èƒ½åŠ›ã€‚å› ä¸ºè¿™äº›åŸå› ï¼Œä»Elasticsearch7.xä¸­ç§»é™¤ç±»å‹çš„æ¦‚å¿µ;

### 9ã€æ˜ å°„

æ‰€æœ‰æ–‡æ¡£å†™è¿›ç´¢å¼•ä¹‹å‰éƒ½ä¼šå…ˆè¿›è¡Œåˆ†æï¼šå¦‚ä½•å°†è¾“å…¥çš„æ–‡æœ¬åˆ†éš”ä¸ºè¯æ¡ã€å“ªäº›è¯æ¡åˆä¼šè¢«è¿‡æ»¤ï¼›è¿™ç§è¡Œä¸ºç§°ä¸ºæ˜ å°„ï¼Œä¸€èˆ¬ç”±ç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™ï¼Œæ¯”å¦‚ä½¿ç”¨ä¸­æ–‡åˆ†è¯

- settingsï¼šè®¾ç½®ç´¢å¼•åˆ†ç‰‡å’Œéƒ¨åˆ†
- mappingsï¼šè®¾ç½®ç´¢å¼•æ˜ å°„
  - propertiesï¼šè¯¥å¯¹è±¡åŒ…å«æ˜ å°„åˆ°å­—æ®µ
    - [fields]ï¼šè¯¥å¯¹è±¡ç”¨äºè¯´æ˜å­—æ®µç›¸å…³çš„çº¦æŸ
      - typeï¼šè¡¨ç¤ºå­—æ®µçš„ç±»å‹
      - formatï¼šè¡¨ç¤ºå­—æ®µçš„æ ¼å¼åŒ–æ–¹å¼ï¼Œé’ˆå¯¹dateç±»å‹
      - analyzerï¼šè¡¨ç¤ºä½¿ç”¨çš„æŸ¥è¯¢åˆ†æå™¨
      - propertiesï¼šåŒä¸Šè¡¨ç¤ºåµŒå¥—å¯¹è±¡ï¼ŒåµŒå¥—å¯¹è±¡çš„typeç±»å‹æ˜¯é»˜è®¤æ˜¯object

ğŸ’›åŸæ–‡åœ°å€ä¸ºhttps://www.cnblogs.com/haixiang/p/12040272.htmlï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„!
ğŸ**esä¸SpringBootçš„æ•´åˆä»¥åŠå¸¸ç”¨CRUDã€æœç´¢APIå·²è¢«ä½œè€…å°è£…,å¼€ç®±å³ç”¨æ•ˆæœå¾ˆå¥½,æ¬¢è¿starè°¢è°¢!**[github](https://github.com/Motianshi/all-search)

## Mappingç®€ä»‹[#](https://www.cnblogs.com/haixiang/p/12040272.html#1119358845)

mapping æ˜¯ç”¨æ¥å®šä¹‰æ–‡æ¡£åŠå…¶å­—æ®µçš„å­˜å‚¨æ–¹å¼ã€ç´¢å¼•æ–¹å¼çš„æ‰‹æ®µï¼Œä¾‹å¦‚åˆ©ç”¨`mapping` æ¥å®šä¹‰ä»¥ä¸‹å†…å®¹ï¼š

- å“ªäº›å­—æ®µéœ€è¦è¢«å®šä¹‰ä¸ºå…¨æ–‡æ£€ç´¢ç±»å‹
- å“ªäº›å­—æ®µåŒ…å«`number`ã€`date`ç±»å‹ç­‰
- æ ¼å¼åŒ–æ—¶é—´æ ¼å¼
- è‡ªå®šä¹‰è§„åˆ™ï¼Œç”¨äºæ§åˆ¶åŠ¨æ€æ·»åŠ å­—æ®µçš„æ˜ å°„

## Mapping Type

æ¯ä¸ªç´¢å¼•éƒ½æ‹¥æœ‰å”¯ä¸€çš„ `mapping type`ï¼Œç”¨æ¥å†³å®šæ–‡æ¡£å°†å¦‚ä½•è¢«ç´¢å¼•ã€‚`mapping type`ç”±ä¸‹é¢ä¸¤éƒ¨åˆ†ç»„æˆ

- Meta-fields
  å…ƒå­—æ®µç”¨äºè‡ªå®šä¹‰å¦‚ä½•å¤„ç†æ–‡æ¡£çš„ç›¸å…³å…ƒæ•°æ®ã€‚ å…ƒå­—æ®µçš„ç¤ºä¾‹åŒ…æ‹¬æ–‡æ¡£çš„_indexï¼Œ_typeï¼Œ_idå’Œ_sourceå­—æ®µã€‚
- Fields or properties
  æ˜ å°„ç±»å‹åŒ…å«ä¸æ–‡æ¡£ç›¸å…³çš„å­—æ®µæˆ–å±æ€§çš„åˆ—è¡¨ã€‚

## åˆ†è¯å™¨æœ€ä½³å®è·µ[#](https://www.cnblogs.com/haixiang/p/12040272.html#3142227410)

å› ä¸ºåç»­çš„`keyword`å’Œ`text`è®¾è®¡åˆ†è¯é—®é¢˜ï¼Œè¿™é‡Œç»™å‡ºåˆ†è¯æœ€ä½³å®è·µã€‚å³**ç´¢å¼•æ—¶ç”¨ik_max_wordï¼Œæœç´¢æ—¶åˆ†è¯å™¨ç”¨ik_smart**ï¼Œè¿™æ ·ç´¢å¼•æ—¶æœ€å¤§åŒ–çš„å°†å†…å®¹åˆ†è¯ï¼Œæœç´¢æ—¶æ›´ç²¾ç¡®çš„æœç´¢åˆ°æƒ³è¦çš„ç»“æœã€‚

ä¾‹å¦‚æˆ‘æƒ³æœç´¢çš„æ˜¯å°ç±³æ‰‹æœºï¼Œæˆ‘æ­¤æ—¶çš„æƒ³æ³•æ˜¯æƒ³æœç´¢å‡ºå°ç±³æ‰‹æœºçš„å•†å“ï¼Œè€Œä¸æ˜¯å°ç±³éŸ³å“ã€å°ç±³æ´—è¡£æœºç­‰å…¶ä»–äº§å“ï¼Œä¹Ÿå°±æ˜¯è¯´å•†å“ä¿¡æ¯ä¸­å¿…é¡»åªæœ‰å°ç±³æ‰‹æœºè¿™ä¸ªè¯ã€‚

æˆ‘ä»¬åç»­ä¼šä½¿ç”¨`"search_analyzer": "ik_smart"`æ¥å®ç°è¿™æ ·çš„éœ€æ±‚ã€‚

## å­—æ®µç±»å‹[#](https://www.cnblogs.com/haixiang/p/12040272.html#2026557297)

- ä¸€ç§ç®€å•çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚`text`ã€`keyword`ã€`double`ã€`boolean`ã€`long`ã€`date`ã€`ip`ç±»å‹ã€‚
- ä¹Ÿå¯ä»¥æ˜¯ä¸€ç§åˆ†å±‚çš„jsonå¯¹è±¡ï¼ˆæ”¯æŒå±æ€§åµŒå¥—ï¼‰ã€‚
- ä¹Ÿå¯ä»¥æ˜¯ä¸€äº›ä¸å¸¸ç”¨çš„ç‰¹æ®Šç±»å‹ï¼Œä¾‹å¦‚`geo_point`ã€`geo_shape`ã€`completion`

é’ˆå¯¹åŒä¸€å­—æ®µæ”¯æŒå¤šç§å­—æ®µç±»å‹å¯ä»¥æ›´å¥½åœ°æ»¡è¶³æˆ‘ä»¬çš„æœç´¢éœ€æ±‚ï¼Œä¾‹å¦‚ä¸€ä¸ª`string`ç±»å‹çš„å­—æ®µå¯ä»¥è®¾ç½®ä¸º`text`æ¥æ”¯æŒå…¨æ–‡æ£€ç´¢ï¼Œä¸æ­¤åŒæ—¶ä¹Ÿå¯ä»¥è®©è¿™ä¸ªå­—æ®µæ‹¥æœ‰`keyword`ç±»å‹æ¥åšæ’åºå’Œèšåˆï¼Œå¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºå­—æ®µå•ç‹¬é…ç½®åˆ†è¯æ–¹å¼ï¼Œä¾‹å¦‚`"analyzer": "ik_max_word",`

### text ç±»å‹[#](https://www.cnblogs.com/haixiang/p/12040272.html#4164760018)

`text`ç±»å‹çš„å­—æ®µç”¨æ¥åšå…¨æ–‡æ£€ç´¢ï¼Œä¾‹å¦‚é‚®ä»¶çš„ä¸»é¢˜ã€æ·˜å®äº¬ä¸œä¸­å•†å“çš„æè¿°ç­‰ã€‚è¿™ç§å­—æ®µåœ¨è¢«ç´¢å¼•å­˜å‚¨å‰**å…ˆè¿›è¡Œåˆ†è¯**ï¼Œå­˜å‚¨çš„æ˜¯åˆ†è¯åçš„ç»“æœï¼Œè€Œä¸æ˜¯å®Œæ•´çš„å­—æ®µã€‚`text`å­—æ®µä¸é€‚åˆåšæ’åºå’Œèšåˆã€‚å¦‚æœæ˜¯ä¸€äº›ç»“æ„åŒ–å­—æ®µï¼Œåˆ†è¯åæ— æ„ä¹‰çš„å­—æ®µå»ºè®®ä½¿ç”¨`keyword`ç±»å‹ï¼Œä¾‹å¦‚é‚®ç®±åœ°å€ã€ä¸»æœºåã€å•†å“æ ‡ç­¾ç­‰ã€‚

å¸¸æœ‰å‚æ•°åŒ…å«ä»¥ä¸‹

- analyzerï¼šç”¨æ¥åˆ†è¯ï¼ŒåŒ…å«**ç´¢å¼•å­˜å‚¨é˜¶æ®µ**å’Œ**æœç´¢é˜¶æ®µ**ï¼ˆå…¶ä¸­æŸ¥è¯¢é˜¶æ®µå¯ä»¥è¢«**search_analyzer**å‚æ•°è¦†ç›–ï¼‰ï¼Œè¯¥å‚æ•°é»˜è®¤è®¾ç½®ä¸ºindexçš„analyzerè®¾ç½®æˆ–è€…standard analyzer
- indexï¼šæ˜¯å¦å¯ä»¥è¢«æœç´¢åˆ°ã€‚é»˜è®¤æ˜¯`true`
- fieldsï¼šMulti-fieldså…è®¸åŒä¸€ä¸ªå­—ç¬¦ä¸²å€¼åŒæ—¶è¢«ä¸åŒçš„æ–¹å¼ç´¢å¼•ï¼Œä¾‹å¦‚ç”¨ä¸åŒçš„analyzerä½¿ä¸€ä¸ªfieldç”¨æ¥æ’åºå’Œèšç±»ï¼Œå¦ä¸€ä¸ªåŒæ ·çš„stringç”¨æ¥åˆ†æå’Œå…¨æ–‡æ£€ç´¢ã€‚ä¸‹é¢ä¼šåšè¯¦ç»†çš„è¯´æ˜
- search_analyzerï¼šè¿™ä¸ªå­—æ®µç”¨æ¥æŒ‡å®š**æœç´¢é˜¶æ®µ**æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨ï¼Œé»˜è®¤ä½¿ç”¨`analyzer`çš„è®¾ç½®
- search_quote_analyzerï¼šæœç´¢é‡åˆ°çŸ­è¯­æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨ï¼Œé»˜è®¤ä½¿ç”¨`search_analyzer`çš„è®¾ç½®

### keyword ç±»å‹[#](https://www.cnblogs.com/haixiang/p/12040272.html#3592965838)

`keyword`ç”¨äºç´¢å¼•ç»“æ„åŒ–å†…å®¹ï¼ˆä¾‹å¦‚ç”µå­é‚®ä»¶åœ°å€ï¼Œä¸»æœºåï¼ŒçŠ¶æ€ä»£ç ï¼Œé‚®æ”¿ç¼–ç æˆ–æ ‡ç­¾ï¼‰çš„å­—æ®µï¼Œè¿™äº›å­—æ®µè¢«æ‹†åˆ†åä¸å…·æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥åœ¨esä¸­åº”**ç´¢å¼•å®Œæ•´çš„å­—æ®µ**ï¼Œè€Œä¸æ˜¯åˆ†è¯åçš„ç»“æœã€‚

é€šå¸¸ç”¨äºè¿‡æ»¤ï¼ˆä¾‹å¦‚åœ¨åšå®¢ä¸­æ ¹æ®å‘å¸ƒçŠ¶æ€æ¥æŸ¥è¯¢æ‰€æœ‰å·²å‘å¸ƒæ–‡ç« ï¼‰ï¼Œæ’åºå’Œèšåˆã€‚`keyword`åªèƒ½æŒ‰ç…§å­—æ®µç²¾ç¡®æœç´¢ï¼Œä¾‹å¦‚æ ¹æ®æ–‡ç« idæŸ¥è¯¢æ–‡ç« è¯¦æƒ…ã€‚å¦‚æœæƒ³æ ¹æ®æœ¬å­—æ®µè¿›è¡Œå…¨æ–‡æ£€ç´¢ç›¸å…³è¯æ±‡ï¼Œå¯ä»¥ä½¿ç”¨`text`ç±»å‹ã€‚

Copy

```json
PUT my_index
{
  "mappings": {
    "properties": {
      "tags": {
        "type":  "keyword"
      }
    }
  }
}
```

- indexï¼šæ˜¯å¦å¯ä»¥è¢«æœç´¢åˆ°ã€‚é»˜è®¤æ˜¯`true`
- fieldsï¼šMulti-fieldså…è®¸åŒä¸€ä¸ªå­—ç¬¦ä¸²å€¼åŒæ—¶è¢«ä¸åŒçš„æ–¹å¼ç´¢å¼•ï¼Œä¾‹å¦‚ç”¨ä¸åŒçš„analyzerä½¿ä¸€ä¸ªfieldç”¨æ¥æ’åºå’Œèšç±»ï¼Œå¦ä¸€ä¸ªåŒæ ·çš„stringç”¨æ¥åˆ†æå’Œå…¨æ–‡æ£€ç´¢ã€‚ä¸‹é¢ä¼šåšè¯¦ç»†çš„è¯´æ˜
- null_valueï¼šå¦‚æœè¯¥å­—æ®µä¸ºç©ºï¼Œè®¾ç½®çš„é»˜è®¤å€¼ï¼Œé»˜è®¤ä¸º`null`
- ignore_aboveï¼šè®¾ç½®ç´¢å¼•å­—æ®µå¤§å°çš„é˜ˆå€¼ã€‚è¯¥å­—æ®µä¸ä¼šç´¢å¼•å¤§å°è¶…è¿‡è¯¥å±æ€§è®¾ç½®çš„å€¼ï¼Œé»˜è®¤ä¸º2147483647ï¼Œä»£è¡¨ç€å¯ä»¥æ¥æ”¶ä»»æ„å¤§å°çš„å€¼ã€‚ä½†æ˜¯è¿™ä¸€å€¼å¯ä»¥è¢«`PUT Mapping Api`ä¸­æ–°è®¾ç½®çš„`ignore_above`æ¥è¦†ç›–è¿™ä¸€å€¼ã€‚

### dateç±»å‹[#](https://www.cnblogs.com/haixiang/p/12040272.html#4169588024)

æ”¯æŒæ’åºï¼Œä¸”å¯ä»¥é€šè¿‡`format`å­—æ®µå¯¹æ—¶é—´æ ¼å¼è¿›è¡Œæ ¼å¼åŒ–ã€‚

`json`ä¸­æ²¡æœ‰æ—¶é—´ç±»å‹ï¼Œæ‰€ä»¥åœ¨esåœ¨è§„å®šå¯ä»¥æ˜¯ä»¥ä¸‹çš„å½¢å¼ï¼š

- ä¸€æ®µæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚`"2015-01-01"`æˆ–è€…`"2015/01/01 12:10:30"`
- ä¸€æ®µ`long`ç±»å‹çš„æ•°å­—ï¼ŒæŒ‡è·æŸä¸ªæ—¶é—´çš„æ¯«ç§’æ•°ï¼Œä¾‹å¦‚`1420070400001`
- ä¸€æ®µ`integer`ç±»å‹çš„æ•°å­—ï¼ŒæŒ‡è·æŸä¸ªæ—¶é—´çš„ç§’æ•°

### objectç±»å‹[#](https://www.cnblogs.com/haixiang/p/12040272.html#3164138260)

`mapping`ä¸­ä¸ç”¨ç‰¹æ„æŒ‡å®šfieldä¸º`object`ç±»å‹ï¼Œå› ä¸ºè¿™æ˜¯å®ƒçš„é»˜è®¤ç±»å‹ã€‚

`json`ç±»å‹å¤©ç”Ÿå…·æœ‰å±‚çº§çš„æ¦‚å¿µï¼Œæ–‡æ¡£å†…éƒ¨è¿˜å¯ä»¥åŒ…å«`object`ç±»å‹è¿›è¡ŒåµŒå¥—ã€‚ä¾‹å¦‚ï¼š

```json
PUT my_index/_doc/1
{ 
  "region": "US",
  "manager": { 
    "age":     30,
    "name": { 
      "first": "John",
      "last":  "Smith"
    }
  }
}
```

åœ¨esä¸­ä¸Šè¿°å¯¹è±¡ä¼šè¢«æŒ‰ç…§ä»¥ä¸‹çš„å½¢å¼è¿›è¡Œç´¢å¼•ï¼š

```json
{
  "region":             "US",
  "manager.age":        30,
  "manager.name.first": "John",
  "manager.name.last":  "Smith"
}
```

`mapping`å¯ä»¥å¯¹ä¸åŒå­—æ®µè¿›è¡Œä¸åŒçš„è®¾ç½®

```json
PUT my_index
{
  "mappings": {
    "properties": { 
      "region": {
        "type": "keyword"
      },
      "manager": { 
        "properties": {
          "age":  { "type": "integer" },
          "name": { 
            "properties": {
              "first": { "type": "text" },
              "last":  { "type": "text" }
            }
          }
        }
      }
    }
  }
}
```

### nestç±»å‹[#](https://www.cnblogs.com/haixiang/p/12040272.html#1806022256)

`nest`ç±»å‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„`object`ç±»å‹ï¼Œå®ƒå…è®¸`object`å¯ä»¥ä»¥æ•°ç»„å½¢å¼è¢«ç´¢å¼•ï¼Œè€Œä¸”æ•°ç»„ä¸­çš„æŸä¸€é¡¹éƒ½å¯ä»¥è¢«ç‹¬ç«‹æ£€ç´¢ã€‚

è€Œä¸”esä¸­æ²¡æœ‰å†…éƒ¨ç±»çš„æ¦‚å¿µï¼Œè€Œæ˜¯é€šè¿‡ç®€å•çš„åˆ—è¡¨æ¥å®ç°`nest`æ•ˆæœï¼Œä¾‹å¦‚ä¸‹åˆ—ç»“æ„çš„æ–‡æ¡£ï¼š

```json
PUT my_index/_doc/1
{
  "group" : "fans",
  "user" : [ 
    {
      "first" : "John",
      "last" :  "Smith"
    },
    {
      "first" : "Alice",
      "last" :  "White"
    }
  ]
}
```

ä¸Šé¢æ ¼å¼çš„å¯¹è±¡ä¼šè¢«æŒ‰ç…§ä¸‹åˆ—æ ¼å¼è¿›è¡Œç´¢å¼•ï¼Œå› æ­¤ä¼šå‘ç°ä¸€ä¸ªuserä¸­çš„ä¸¤ä¸ªå±æ€§å€¼ä¸å†åŒ¹é…ï¼Œ`alice`å’Œ`white`å¤±å»äº†è”ç³»

```json
{
  "group" :        "fans",
  "user.first" : [ "alice", "john" ],
  "user.last" :  [ "smith", "white" ]
}
```

### rangeç±»å‹[#](https://www.cnblogs.com/haixiang/p/12040272.html#2473687704)

æ”¯æŒä»¥ä¸‹èŒƒå›´ç±»å‹ï¼š

| ç±»å‹          | èŒƒå›´                                 |
| ------------- | ------------------------------------ |
| integer_range | `-2çš„31æ¬¡` åˆ° `2çš„31æ¬¡-1`.           |
| float_range   | 32ä½å•ç²¾åº¦æµ®ç‚¹æ•°                     |
| long_range    | `-2çš„63æ¬¡` åˆ° `2çš„63æ¬¡-1`.           |
| double_range  | 64ä½åŒç²¾åº¦æµ®ç‚¹æ•°                     |
| date_range    | unsigned 64-bit integer milliseconds |
| ip_range      | ipv4å’Œipv6æˆ–è€…ä¸¤è€…çš„æ··åˆ             |

ä½¿ç”¨èŒƒä¾‹ä¸ºï¼š

```json
PUT range_index
{
  "settings": {
    "number_of_shards": 2
  },
  "mappings": {
    "properties": {
      "age_range": {
        "type": "integer_range"
      },
      "time_frame": {
        "type": "date_range", 
        "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"
      }
    }
  }
}

PUT range_index/_doc/1?refresh
{
  "age_range" : { 
    "gte" : 10,
    "lte" : 20
  },
  "time_frame" : { 
    "gte" : "2015-10-31 12:00:00", 
    "lte" : "2015-11-01"
  }
}
```

## å®æˆ˜ï¼šåŒæ—¶ä½¿ç”¨keywordå’Œtextç±»å‹[#](https://www.cnblogs.com/haixiang/p/12040272.html#2674254835)

**æ³¨ï¼štermæ˜¯æŸ¥è¯¢æ—¶å¯¹å…³é”®å­—ä¸åˆ†è¯ï¼Œkeywordæ˜¯ç´¢å¼•æ—¶ä¸åˆ†è¯**

ä¸Šè¿°æˆ‘ä»¬è®²è§£è¿‡`keyword`å’Œ`text`ä¸€ä¸ªä¸åˆ†è¯ç´¢å¼•ï¼Œä¸€ä¸ªæ˜¯åˆ†è¯åç´¢å¼•ï¼Œæˆ‘ä»¬åˆ©ç”¨ä»–ä»¬çš„`fields`å±æ€§æ¥è®©å½“å‰å­—æ®µåŒæ—¶å…·å¤‡`keyword`å’Œ`text`ç±»å‹ã€‚

é¦–å…ˆæˆ‘ä»¬åˆ›å»ºç´¢å¼•å¹¶æŒ‡å®š`mapping`ï¼Œä¸º`title`åŒæ—¶è®¾ç½®`keyword`å’Œ`text`å±æ€§

Copy

```json
PUT /idx_item/
{
  "settings": {
    "index": {
        "number_of_shards" : "2",
        "number_of_replicas" : "0"
    }
  },
  "mappings": {
    "properties": {
      "itemId" : {
        "type": "keyword",
        "ignore_above": 64
      },
      "title" : {
        "type": "text",
        "analyzer": "ik_max_word", 
        "search_analyzer": "ik_smart", 
        "fields": {
          "keyword" : {"ignore_above" : 256, "type" : "keyword"}
        }
      },
      "desc" : {"type": "text", "analyzer": "ik_max_word"},
      "num" : {"type": "integer"},
      "price" : {"type": "long"}
    }
  }
}
```

æˆ‘ä»¬å·²ç»å¾€esä¸­æ’å…¥ä»¥ä¸‹æ•°æ®

| _index   | _type | _id                  | _score | itemId | title                     | desc                                 | num  | Price |
| -------- | ----- | -------------------- | ------ | ------ | ------------------------- | ------------------------------------ | ---- | ----- |
| idx_item | _doc  | rvsX-W4Bo-iJGWqbQ8dk | 1      | 1      | è‹æ³Šå°”ç…®é¥­SL3200          | è®©ç…®é¥­æ›´ç®€å•ï¼Œè®©ç”Ÿæ´»æ›´å¿«ä¹           | 100  | 200   |
| idx_item | _doc  | sPsY-W4Bo-iJGWqbscfU | 1      | 3      | å¨æˆ¿èƒ½æ‰‹å¨çŒ›å…ˆç”Ÿ          | ä½ ç…²ç²¥ï¼Œæˆ‘æ´—é”…                       | 100  | 30    |
| idx_item | _doc  | r_sX-W4Bo-iJGWqbhMew | 1      | 2      | è‹æ³Šå°”ç…²ç²¥å¥½èƒ½æ‰‹å‹å·SL322 | ä½ ç…²ç²¥ï¼Œæˆ‘ç…²ç²¥ï¼Œæˆ‘ä»¬ä¸€èµ·è®©ç…²ç²¥æ›´ç®€å• | 100  | 190   |

`title=â€è‹æ³Šå°”ç…®é¥­SL3200â€œ` æ ¹æ®`text`ä»¥åŠæœ€ç»†ç²’åº¦åˆ†è¯è®¾ç½®`"analyzer": "ik_max_word"`ï¼Œåœ¨esä¸­æŒ‰ç…§ä»¥ä¸‹å½¢å¼è¿›è¡Œç´¢å¼•å­˜å‚¨

```
{ "è‹æ³Šå°”","ç…®é¥­", "sl3200", "sl","3200"}
```

`title.keyword=â€è‹æ³Šå°”ç…®é¥­SL3200`å› ä¸ºä¸åˆ†è¯ï¼Œæ‰€ä»¥åœ¨esä¸­ç´¢å¼•å­˜å‚¨å½¢å¼ä¸º

```
è‹æ³Šå°”ç…®é¥­SL3200
```

æˆ‘ä»¬é¦–å…ˆå¯¹`title.keyword`è¿›è¡Œæœç´¢ï¼Œåªèƒ½æœç´¢åˆ°ç¬¬ä¸€æ¡æ•°æ®ï¼Œå› ä¸º`match`æœç´¢ä¼šå°†å…³é”®å­—åˆ†è¯ç„¶åå»æœç´¢ï¼Œåˆ†è¯åçš„ç»“æœåŒ…å«`"è‹æ³Šå°”ç…®é¥­SL3200"`æ‰€ä»¥æœç´¢æˆåŠŸï¼Œæˆ‘ä»¬å°†æœç´¢å…³é”®å­—æ”¹ä¸º`è‹æ³Šå°”`ã€`ç…®é¥­`ç­‰éƒ½ä¸ä¼šæŸ¥åˆ°æ•°æ®ã€‚

```json
GET idx_item/_search
{
  "query": {
    "bool": {
      "must": {
        "match": {"title.keyword": "è‹æ³Šå°”ç…®é¥­SL3200"}
        }
    }
  }
}
```

æˆ‘ä»¬æ”¹ç”¨`term`æœç´¢ï¼Œä»–æœç´¢ä¸ä¼šåˆ†è¯ï¼Œæ­£å¥½ä¸esä¸­çš„æ•°æ®ç²¾å‡†åŒ¹é…ï¼Œä¹Ÿåªæœ‰ç¬¬ä¸€æ¡æ•°æ®ï¼Œæˆ‘ä»¬å°†æœç´¢å…³é”®å­—æ”¹ä¸º`è‹æ³Šå°”`ã€`ç…®é¥­`ç­‰éƒ½ä¸ä¼šæŸ¥åˆ°æ•°æ®ã€‚

```json
GET idx_item/_search
{
  "query": {
    "bool": {
      "must": {
        "term": {"title.keyword": "è‹æ³Šå°”ç…®é¥­SL3200"}
        }
    }
  }
}
```

æˆ‘ä»¬ç»§ç»­å¯¹`title`ä½¿ç”¨`match`è¿›è¡ŒæŸ¥è¯¢ï¼Œç»“æœæŸ¥åˆ°äº†ç¬¬ä¸€æ¡å’Œç¬¬ä¸‰æ¡æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬åœ¨esä¸­è¢«ç´¢å¼•çš„æ•°æ®åŒ…å«`è‹æ³Šå°”`å…³é”®å­—

```json
GET idx_item/_search
{
  "query": {
    "bool": {
      "must": {"match": {"title": "è‹æ³Šå°”"}
        }
    }
  }
}
```

æˆ‘ä»¬å¦‚æœæœç´¢`è‹æ³Šå°”ç…®é¥­SL3200`ä¼šå‘ç°æ²¡æœ‰è¿”å›æ•°æ®ï¼Œå› ä¸º`title`åœ¨ç´¢å¼•æ—¶æ²¡æœ‰`è‹æ³Šå°”ç…®é¥­SL3200`è¿™ä¸€é¡¹ï¼Œè€Œ`term`æ—¶æœç´¢å…³é”®å­—ä¹Ÿä¸åˆ†è¯ï¼Œæ‰€ä»¥æ— æ³•åŒ¹é…åˆ°æ•°æ®ã€‚ä½†æ˜¯æˆ‘ä»¬å°†å†…å®¹æ”¹ä¸º`è‹æ³Šå°”`æ—¶ï¼Œå°±å¯ä»¥æœç´¢åˆ°ç¬¬ä¸€æ¡å’Œç¬¬ä¸‰æ¡å†…å®¹ï¼Œå› ä¸ºç¬¬ä¸€æ¡å’Œç¬¬ä¸‰æ¡çš„`title`è¢«åˆ†è¯åçš„ç´¢å¼•åŒ…å«`è‹æ³Šå°”`å­—æ®µï¼Œæ‰€ä»¥å¯ä»¥æŸ¥å‡ºç¬¬ä¸€ä¸‰æ¡ã€‚

```jsaon
"term": {"title": "è‹æ³Šå°”ç…®é¥­SL3200"}
```

## å®æˆ˜ï¼šæ ¼å¼åŒ–æ—¶é—´ã€ä»¥åŠæŒ‰ç…§æ—¶é—´æ’åº[#](https://www.cnblogs.com/haixiang/p/12040272.html#2847931562)

æˆ‘ä»¬åˆ›å»ºç´¢å¼•`idx_pro`ï¼Œå°†`mytimestamp`å’Œ`createTime`å­—æ®µåˆ†åˆ«æ ¼å¼åŒ–æˆä¸¤ç§æ—¶é—´æ ¼

```json
PUT /idx_pro/
{
  "settings": {
    "index": {
        "number_of_shards" : "2",
        "number_of_replicas" : "0"
    }
  },
  "mappings": {
    "properties": {
      "proId" : {
        "type": "keyword",
        "ignore_above": 64
      },
      "name" : {
        "type": "text",
        "analyzer": "ik_max_word", 
        "search_analyzer": "ik_smart", 
        "fields": {
          "keyword" : {"ignore_above" : 256, "type" : "keyword"}
        }
      },
      "mytimestamp" : {
        "type": "date",
        "format": "epoch_millis"
      },
      "createTime" : {
        "type": "date",
        "format": "yyyy-MM-dd HH:mm:ss"
      }
    }
  }
}
```

æ’å…¥å››ç»„æ ·æœ¬æ•°æ®

```json
POST idx_pro/_doc
{
  "proId" : "1",
  "name" : "å†¬æ—¥å·¥è£…è£¤",
  "timestamp" : 1576312053946,
  "createTime" : "2019-12-12 12:56:56"
}
POST idx_pro/_doc
{
  "proId" : "2",
  "name" : "å†¬æ—¥ç¾½ç»’æœ",
  "timestamp" : 1576313210024,
  "createTime" : "2019-12-10 10:50:50"
}
POST idx_pro/_doc
{
  "proId" : "3",
  "name" : "èŠ±èŠ±å…¬å­å¤–å¥—",
  "timestamp" : 1576313239816,
  "createTime" : "2019-12-19 12:50:50"
}
POST idx_pro/_doc
{
  "proId" : "4",
  "name" : "èŠ±èŠ±å…¬å­ç¾½ç»’æœ",
  "timestamp" : 1576313264391,
  "createTime" : "2019-12-12 11:56:56"
}
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`sort`å‚æ•°æ¥è¿›è¡Œæ’åºï¼Œå¹¶ä¸”æ”¯æŒæ•°ç»„å½¢å¼ï¼Œå³åŒæ—¶ä½¿ç”¨å¤šå­—æ®µæ’åºï¼Œåªè¦æ”¹ä¸º`[]`å°±è¡Œ

```json
GET idx_pro/_search
{
  "sort":{"createTime": {"order": "asc"}}, 
  "query": {
    "bool": {
      "must": {"match_all": {}}
    }
  }
}
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨`range`å‚æ•°æ¥æœç´¢æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ•°æ®ï¼Œå½“ç„¶`range`ä¹Ÿæ”¯æŒ`integer`ã€`long`ç­‰ç±»å‹

```json
GET idx_pro/_search
{
  "query": {
    "bool": {
      "must": {
        "range": {
          "timestamp": {
            "gt": "1576313210024",
            "lt": "1576313264391"
          }
        }
      }
    }
  }
}
```

æ‰€æœ‰å†…å®¹çš†ä¸ºä¸ªäººæ€»ç»“æˆ–è½¬è½½åˆ«äººçš„æ–‡ç« ï¼Œåªä¸ºå­¦ä¹ æŠ€æœ¯ã€‚ è‹¥æ‚¨è§‰å¾—æ–‡ç« æœ‰ç”¨ï¼Œæ¬¢è¿ç‚¹èµåˆ†äº«ï¼ è‹¥æ— æ„å¯¹æ‚¨çš„æ–‡ç« é€ æˆä¾µæƒï¼Œè¯·æ‚¨ç•™è¨€ï¼Œåšä¸»çœ‹åˆ°åä¼šåŠæ—¶å¤„ç†ï¼Œè°¢è°¢ã€‚

### 10ã€field

- ä¸€ä¸ªæ–‡æ¡£ä¸­åŒ…å«å¤šä¸ªå±æ€§ï¼Œä¸€è¡Œæ•°æ®ä¸­çš„å¤šä¸ªåˆ—

  | ç±»å‹     |               | è¯´æ˜                                                 |
  | -------- | ------------- | ---------------------------------------------------- |
  | å­—ç¬¦ä¸²   | text          | ä¸€èˆ¬è¢«ç”¨äºå…¨æ–‡æ£€ç´¢ï¼Œå¯ä»¥è¢«åˆ†è¯                       |
  |          | keyword       | ä¸å¯ä»¥è¢«åˆ†è¯                                         |
  | æ•°å€¼     | long          |                                                      |
  |          | integer       |                                                      |
  |          | short         |                                                      |
  |          | byte          |                                                      |
  |          | double        |                                                      |
  |          | float         |                                                      |
  |          | half_float    |                                                      |
  |          | scaled_float  | long+æ¯”ä¾‹è¡¨ç¤ºä¸€ä¸ªæµ®ç‚¹æ•°                              |
  | æ—¶é—´ç±»   | date          | yyyy-MM-dd HH:mm:ss \| yyyy-MM-dd \| epoch-millis    |
  | å¸ƒå°”     | boolean       |                                                      |
  | äºŒè¿›åˆ¶   | binary        | æ”¯æŒbase64çš„å­—ç¬¦ä¸²                                   |
  | èŒƒå›´ç±»å‹ | long_range    | èµ‹å€¼æ—¶æ— éœ€æŒ‡å®šå…·ä½“çš„å†…å®¹,åªéœ€è¦æŒ‡å®šä¸€ä¸ªèŒƒå›´,gt \| lt |
  |          | flaot_range   |                                                      |
  |          | double_range  |                                                      |
  |          | integer_range |                                                      |
  |          | date_range    |                                                      |
  |          | ip_range      |                                                      |
  | ç»çº¬åº¦   | geo_point     | ç”¨æ¥å­˜å‚¨ç»çº¬åº¦                                       |
  | ipç±»å‹   | ip            | IPV4 \| IPV6                                         |

## 3.2 åŸºç¡€æ“ä½œ  - ç´¢å¼•

1. **æ–°å¢ç»“æ„åŒ–ç´¢å¼•**ï¼šnumber_of_shardsåˆ†ç‰‡æ•°æ®ï¼›number_of_replicaså¤‡ä»½æ•°ï¼›åœ¨Luceneä¸­åˆ›å»ºç´¢å¼•æ˜¯éœ€è¦å®šä¹‰å­—æ®µåç§°ä»¥åŠå­—æ®µç±»å‹çš„ï¼Œåœ¨ElasticSearchä¸­æä¾›äº†éç»“æ„åŒ–ç´¢å¼•ï¼Œå°±æ˜¯ä¸éœ€è¦åˆ›å»ºç´¢å¼•ç»“æ„å³å¯å†™æ•°æ®åˆ°ç´¢å¼•ä¸­ï¼Œå®é™…ä¸ŠElasticSearchåœ¨åº•å±‚ä¼šåšç»“æ„åŒ–æ“ä½œï¼Œæ­¤æ“ä½œå¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ã€‚

   ```json
   PUT /person
   {
     "settings": {
       "number_of_shards": 5,
       "number_of_replicas": 1
     }
   }
   ```

2. **æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯**

   ```json
   GET /person
   ```

3. **åˆ é™¤ç´¢å¼•**

   ```json
   DELETE /person
   ```

## 3.3 åŸºç¡€æ“ä½œ - æ–‡æ¡£

1. åˆ›å»ºç´¢å¼•æŒ‡å®šæ•°æ®ç»“æ„

   ```json
   PUT /book
   {
     "settings": {
       "number_of_shards": 5,
       "number_of_replicas": 1
     },
     "mappings": {
       "properties":{
         "name":{
           "type":"text"
         },
         "author":{
           "type":"keyword"
         },
         "count":{
           "type":"long"
         },
         "onSale":{
           "type":"date",
           "format":"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd"
         },
         "descr":{
           "type":"text"
         }
       }
     }
   }
   ```

2. æ–‡æ¡£æ“ä½œ-æ–°å¢ï¼šæ–‡æ¡£åœ¨esæœåŠ¡ä¸­çš„å”¯ä¸€æ ‡è¯†ï¼ˆ_indexç´¢å¼•   _typeç±»å‹  _id ä¸»é”®è‡ªåŠ¨ç”Ÿæˆï¼‰

   ```json
   # è‡ªåŠ¨ç”Ÿæˆ_id
   POST /book/_doc
   {
     "name": "ç›˜é¾™",
     "author": "åœŸè±†",
     "count": "652354457",
     "onSale": "2020-12-23",
     "descr": "ä¸ºä»€ä¹ˆä¸èƒ½ä¿®æ”¹ä¸€ä¸ªå­—æ®µçš„typeï¼ŸåŸå› æ˜¯ä¸€ä¸ªå­—æ®µçš„ç±»å‹ä¿®æ”¹ä»¥åï¼Œé‚£ä¹ˆè¯¥å­—æ®µçš„æ‰€æœ‰æ•°æ®éƒ½éœ€è¦é‡æ–°ç´¢å¼•ã€‚Elasticsearchåº•å±‚ä½¿ç”¨çš„æ˜¯luceneåº“ï¼Œå­—æ®µç±»å‹ä¿®æ”¹ä»¥åç´¢å¼•å’Œæœç´¢è¦æ¶‰åŠåˆ†è¯æ–¹å¼ç­‰æ“ä½œï¼Œä¸å…è®¸ä¿®æ”¹ç±»å‹åœ¨æˆ‘çœ‹æ¥æ˜¯ç¬¦åˆluceneæœºåˆ¶çš„ã€‚"
   }
   ```

3. æ–‡æ¡£æ“ä½œ - æ–°å¢ æ‰‹åŠ¨æŒ‡å®šID

   ```json
   POST /book/_doc/1
   {
     "name": "å‡¡äººä¿®ä»™",
     "author": "å¤©èš•",
     "count": "652354457",
     "onSale": "2020-12-23",
     "descr": "æˆ‘æ¬²æˆä»™"
   }
   ```

4. æ–‡æ¡£æ“ä½œ - è¦†ç›–å¼ä¿®æ”¹ å¦‚æœIDå­˜åœ¨å€¼åˆ™å­—æ®µå…¨é‡æ›´æ–°

   ```json
   POST /book/_doc/1
   {
     "name": "å‡¡äººä¿®ä»™",
     "author": "å¤©èš•",
     "count": "652354457",
     "descr": "å¿«ä¹ä¸ƒå¤©"
   }
   ```

5. æ–‡æ¡£æ“ä½œ - æ‡’ä¿®æ”¹

   ```json
   POST /book/_doc/1/_update
   {
     "doc":{
         "count": "652354457",
         "onSale": "2020-12-23"
     }
   }
   ```

6. åˆ é™¤æ–‡æ¡£

   ```json
   DELETE /book/_doc/87bgvnMBZnIOh5hMwAW5
   ```

## 3.4 åŸºç¡€æ“ä½œ - æ£€ç´¢

- åˆ›å»ºæµ‹è¯•æ•°æ®

  ```json
  PUT /sms_logs_index
  {
    "settings": {
      "number_of_shards": 5,
      "number_of_replicas": 1
    },
    "mappings": {
      "properties": {
        "createTime":{
          "type": "date",
          "format": ["yyyy-MM-dd HH:mm:ss"]
        },
        "sendTime":{
          "type": "date",
          "format": ["yyyy-MM-dd HH:mm:ss"]
        },
        "longCode":{
          "type": "keyword"
        },
        "mobile":{
          "type": "text"
        },
        "cropName":{
          "type": "text"
        },
        "smsContent":{
          "type": "text"
        },
        "status":{
          "type": "integer"
        },
        "operatorId":{
          "type": "integer"
        },
        "province":{
          "type": "text"
        },
        "ipAddr":{
          "type": "text"
        },
        "fee":{
          "type": "long"
        }
      }
    }
  }
  ```

- æ·»åŠ æµ‹æ•°æ®

  ```json
  POST /sms_logs_index/_doc
  {
    "createTime":"2020-07-01 12:00:00",
    "sendTime":"2020-07-01 12:00:00",
    "longCode":"2020701120000",
    "mobile":"18700136671",
    "cropName":"å¥‡ç‚¹",
    "smsContent":"çŸ­ä¿¡æ¿€æ´»æˆåŠŸ",
    "status":1,
    "operatorId":0,
    "province":"é™•è¥¿çœ",
    "ipAddr":"192.168.0.123",
    "fee":15
  }
  ```

  ```json
  POST /sms_logs_index/_doc
  {
    "createTime":"2020-07-02 12:00:00",
    "sendTime":"2020-07-02 12:00:00",
    "longCode":"2020702120000",
    "mobile":"18700131171",
    "cropName":"å¥‡ç‚¹",
    "smsContent":"çŸ­ä¿¡æ¿€æ´»å¤±è´¥",
    "status":1,
    "operatorId":0,
    "province":"æµ™æ±Ÿçœ",
    "ipAddr":"192.168.0.124",
    "fee":25
  }
  ```

  ```json
  POST /sms_logs_index/_doc
  {
    "createTime":"2020-07-04 12:00:00",
    "sendTime":"2020-07-04 12:00:00",
    "longCode":"2020704120000",
    "mobile":"18700134471",
    "cropName":"å¥‡ç‚¹",
    "smsContent":"çŸ­ä¿¡ç™»é™†å¼‚å¸¸è´¥",
    "status":1,
    "operatorId":0,
    "province":"æµ™æ±Ÿçœ",
    "ipAddr":"192.168.0.144",
    "fee":35
  }
  ```

  ```json
  POST /sms_logs_index/_doc
  {
    "createTime":"2020-07-05 12:00:00",
    "sendTime":"2020-07-05 12:00:00",
    "longCode":"2020705120000",
    "mobile":"18700135571",
    "cropName":"å¥‡ç‚¹",
    "smsContent":"çŸ­ä¿¡ç™»é™†å¼‚å¸¸è´¥",
    "status":1,
    "operatorId":0,
    "province":"å±±è¥¿çœ",
    "ipAddr":"192.168.0.244",
    "fee":65
  }
  ```

  ```json
  POST /sms_logs_index/_doc
  {
    "createTime":"2020-07-07 12:00:00",
    "sendTime":"2020-07-07 12:00:00",
    "longCode":"2020707120000",
    "mobile":"18700137771",
    "cropName":"å¥‡ç‚¹",
    "smsContent":"é‚®ä»¶éªŒè¯ç ç™»é™†å¼‚å¸¸è´¥",
    "status":1,
    "operatorId":2,
    "province":"å±±ä¸œçœ",
    "ipAddr":"192.168.0.164",
    "fee":55
  }
  ```

  ```json
  POST /sms_logs_index/_doc
  {
    "createTime":"2020-07-08 12:00:00",
    "sendTime":"2020-07-08 12:00:00",
    "longCode":"2020708120000",
    "mobile":"187001378871",
    "cropName":"å¥‡ç‚¹",
    "smsContent":"é‚®ä»¶éªŒè¯ç ç™»é™†æˆåŠŸ",
    "status":0,
    "operatorId":2,
    "province":"å±±ä¸œçœ",
    "ipAddr":"192.168.0.124",
    "fee":55
  }
  ```

  ```json
  POST /sms_logs_index/_doc
  {
    "createTime":"2020-07-10 12:00:00",
    "sendTime":"2020-07-10 12:00:00",
    "longCode":"2020710120000",
    "mobile":"187001377971",
    "cropName":"å¥‡ç‚¹",
    "smsContent":"ä¸çŸ¥é“å‘ä»€ä¹ˆå†…å®¹äº†",
    "status":1,
    "operatorId":2,
    "province":"å±±ä¸œçœ",
    "ipAddr":"192.168.0.154",
    "fee":55
  }
  ```


1. termæŸ¥è¯¢ï¼šä»£è¡¨å®Œå…¨åŒ¹é…ï¼Œæœç´¢ä¹‹å‰ä¸ä¼šå¯¹æœç´¢å…³é”®å­—è¿›è¡Œåˆ†è¯ï¼Œç›´æ¥ç”¨å…³é”®å­—å»æ–‡æ¡£åˆ†è¯åº“ä¸­å»åŒ¹é…å†…å®¹

   ```json
   POST /sms_logs_index/_search
   {
     "from":0,
     "size":5,
     "query":{
       "term":{
         "longCode": {
           "value":"2020710120000"
         }
       }
     }
   }
   ```

2. termsæŸ¥è¯¢ï¼šå’ŒtermæŸ¥è¯¢æœºåˆ¶æ˜¯ä¸€æ ·çš„ï¼Œtermsé’ˆå¯¹çš„æ˜¯ä¸€ä¸ªå­—æ®µä¸­åŒ…å«å¤šä¸ªå€¼çš„çš„æ—¶å€™ä½¿ç”¨

   ```json
   POST /sms_logs_index/_search
   {
     "query": {
       "terms": {
         "longCode": [
           "2020701120000",
           "2020705120000",
           "2020707120000"
         ]
       }
     }
   }
   ```

3. matchæŸ¥è¯¢ï¼šå±äºé«˜å±‚æŸ¥è¯¢ï¼Œä¼šæ ¹æ®æŸ¥è¯¢å­—æ®µç±»å‹çš„ä¸åŒï¼Œé‡‡ç”¨ä¸åŒçš„æŸ¥è¯¢æ–¹å¼ï¼ŒæŸ¥è¯¢æ—¥æœŸæˆ–æ•°å­—æ—¶ä¼šå°†å­—ç¬¦ä¸²å½¢å¼è½¬ä¸ºæ—¥æœŸæˆ–æ•°å€¼

   - å¦‚æœæŸ¥è¯¢çš„çš„å†…å®¹æ˜¯ä¸€ä¸ªä¸èƒ½è¢«åˆ†è¯çš„å†…å®¹ï¼ŒmatchæŸ¥è¯¢ä¸ä¼šå¯¹æŒ‡å®šçš„æŸ¥è¯¢å…³é”®å­—è¿›è¡Œåˆ†è¯æŸ¥è¯¢
   - å¦‚æœæŸ¥è¯¢çš„å†…å®¹æ˜¯ä¸€ä¸ªå¯ä»¥è¢«åˆ†è¯çš„å†…å®¹ï¼ŒmatchæŸ¥è¯¢ä¼šå°†æŒ‡å®šçš„æŸ¥è¯¢å…³é”®å­—è¿›è¡Œåˆ†è¯å¤„ç†
   - matchåº•å±‚ä¹Ÿæ˜¯termæŸ¥è¯¢ï¼Œå°†å¤šä¸ªtermæŸ¥è¯¢çš„ç»“æœåˆ†é’Ÿä¸ºä¸€ä¸ªç»“æœ

   ```json
   POST /sms_logs_index/_search
   {
     "query": {
       "match": {
         "smsContent": "æ¿€æ´»"
       }
     }
   }
   ```

   - operatorï¼šè¡¨ç¤ºå¤šä¸ªæ¡ä»¶çš„å…³ç³»:and or

   ```json
   POST /sms_logs_index/_search
   {
     "query": {
       "match": {
         "smsContent": {
           "query": "é‚® è´¥",
           "operator": "and"
         }
       }
     }
   }
   ```

4. match_allï¼šæŸ¥è¯¢æ‰€æœ‰ï¼Œé»˜è®¤è¿”å›10æ¡

   ```json
   POST /sms_logs_index/_search
   {
     "query": {
       "match_all": {}
     }
   }
   ```

5. multi_matchï¼šé’ˆå¯¹å¤šä¸ªfiledè¿›è¡Œæ£€ç´¢

   ```json
   POST /sms_logs_index/_search
   {
     "query": {
       "multi_match": {
         "query": "å±±",
         "fields": ["province","smsContent"]
       }
     }
   }
   ```

6. é€šè¿‡idæŸ¥è¯¢

   ```json
   GET /sms_logs_index/_doc/ziHIw3MBHuQcg1zLPCJY
   ```

   ```json
   POST /sms_logs_index/_search
   {
     "query": {
       "ids": {
         "values": ["AiHKw3MBHuQcg1zLSSMz","ziHIw3MBHuQcg1zLPCJY"]
       }
     }
   }
   ```

7. perfixï¼šå‰ç¼€åŒ¹é…æŸ¥è¯¢

   ```json
   POST /sms_logs_index/_search
   {
     "query": {
       "prefix": {
         "mobile": {
           "value": "187"
         }
       }
     }
   }
   ```

8. fuzzyæŸ¥è¯¢ï¼šæ¨¡ç³ŠæŸ¥è¯¢ï¼Œè¾“å…¥å­—ç¬¦çš„å¤§æ¦‚å°±å¯ä»¥æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸ç¨³å®š

   ```json
   POST /sms_logs_index/_search
   {
     "query": {
       "fuzzy": {
         "mobile": {
           "value": "187",
           "prefix_length": 3		# å¤ªæ¨¡ç³Šæ•ˆç‡ä½ï¼ŒæŒ‡å®šå‰ä¸‰ä¸ªå­—ç¬¦ä¸èƒ½é”™
         }
       }
     }
   }
   ```

9. wildcardï¼šå’Œmysqlçš„likeæ˜¯ä¸€ä¸ªå¥—è·¯ï¼Œåœ¨æŸ¥è¯¢å…³é”®å­—ä¸­æŒ‡å®šé€šé…ç¬¦*å’Œå ä½ç¬¦?

   ```json
   POST /sms_logs_index/_search
   {
     "query": {
       "wildcard": {
         "smsContent": {
           "value": "*ä¿¡"
         }
       }
     }
   }
   
   ```

10. rangeï¼šåªèƒ½é’ˆå¯¹æ•°å€¼ç±»å‹çš„æŸ¥è¯¢ï¼Œå­—ç¬¦ä¸²èŒƒå›´æŸ¥è¯¢æ— æ•ˆ

   - gt
   - gte
   - lt
   - lte

   ```json
   POST /sms_logs_index/_search
   {
     "query": {
       "range": {
         "fee": {
           "gte": 10,
           "lte": 60
         }
       }
     }
   }
   ```

11. regexpï¼šæ­£åˆ™æŸ¥è¯¢ï¼Œprefixã€fuzzyã€wildcardã€regexpæŸ¥è¯¢æ•ˆç‡ä½

    ```json
    POST /sms_logs_index/_search
    {
      "query": {
        "regexp": {
          "mobile": "[0-9]{3}0013[-0-9]{4}"
        }
      }
    }
    ```

12. scroll

    - åˆ†é¡µï¼šeså¯¹formå’ŒsizeæŸ¥è¯¢æœ‰é™åˆ¶ï¼Œå¦‚æœformå’Œsizeçš„èŒƒå›´è¶…è¿‡ä¸€åŠï¼Œæ•ˆç‡æ˜¯éå¸¸éå¸¸æ…¢ï¼Œ
    - scrollæ˜¯æ·±åˆ†é¡µï¼Œæ•ˆç‡é«˜ä½†æ˜¯ä¸é€‚åˆå®æ—¶æŸ¥è¯¢

    ```json
    POST /sms_logs_index/_search?scroll=1m
    {
      "size": 2, 
      "sort": [
        {
          "createTime": {
            "order": "asc"
          }
        }
      ], 
      "query": {
        "match_all": {}
      }
    }
    ```

    - æ ¹æ®scrollåˆ†é¡µæ£€ç´¢ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šä»å†…å­˜æ€»è·å–ä¸‹ä¸€é¡µçš„æ•°æ®

    ```json
    POST /_search/scroll
    {
      "scroll_id":"å†…å­˜ä¸­çš„id",
      "scroll":"1m"
    }
    ```

    - ä»å†…å­˜ä¸­åˆ é™¤

    ```json
    DELETE /_search/scroll/scroll_id
    ```

13. delete-by-qyeryï¼šæ ¹æ®å„ç§æŸ¥è¯¢æ–¹å¼åˆ é™¤æ–‡æ¡£

    ```json
    POST /sms_logs_index/_delete_by_query
    {
      "query": {
        "range": {
          "fee": {
            "gte": 40,
            "lte": 50
          }
        }
      }
    }
    
    ```

14. ç¬¦åˆæŸ¥è¯¢boolï¼šå¤åˆè¿‡æ»¤å™¨ï¼Œå°†å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œä»¥ä¸€å®šé€»è¾‘ç»„åˆåœ¨ä¸€èµ·

    - mastï¼šæ‰€æœ‰æ¡ä»¶ç”¨mastç»„åˆï¼Œand
    - must_notï¼šå…¨éƒ¨éƒ½ä¸åŒ¹é…ï¼Œnot
    - shouldï¼šå…¨éƒ¨æ¡ä»¶ç»„åˆåœ¨ä¸€èµ·,or

    ```json
    POST /sms_logs_index/_search
    {
      "query": {
        "bool": {
          "must": [
            {
              "term": {
                "status": {
                  "value": "1"
                }
              }
            },
            {
              "term": {
                "fee": {
                  "value": "15"
                }
              }
            }
          ],
          "must_not": [
            {
              "term": {
                "operatorId": {
                  "value": "1"
                }
              }
            }
          ],
          "should": [
            {
              "match": {
                "smsContent": "çŸ­"
              }
            }
          ]
        }
      }
    }
    ```

15. å¤åˆæŸ¥è¯¢boostingï¼šå¸®åŠ©æŸ¥è¯¢å½±å“æŸ¥è¯¢ç»“æœçš„scrollåˆ†æ•°

    - positiveï¼šåªæœ‰åŒ¹é…ä¸Špositiveçš„å†…å®¹æ‰ä¼šæ”¾åœ¨ç»“æœé›†ä¸­
    - negativeï¼šåŒ¹é…ä¸Špositiveå¹¶ä¸”åŒ¹é…ä¸Šnegativeï¼Œå°±å¯ä»¥é™ä½æ–‡æ¡£åˆ†æ•°
    - negative_boostï¼šæŒ‡å®šç³»æ•°ï¼Œå¦‚ï¼šå¿…é¡»å°äº1.0
    - åˆ†æ•°è®¡ç®—
      - æœç´¢å…³é”®å­—åŒ¹é…æ¬¡æ•°è¶Šå¤šï¼Œåˆ†æ•°è¶Šé«˜
      - æœç´¢æ˜¯æ–‡æ¡£è¶ŠçŸ­ï¼ŒåŒ¹é…åº¦è¶Šé«˜
      - æœç´¢å…³é”®å­—è¢«åˆ†è¯ï¼Œåˆ†è¯çš„å†…å®¹è¢«åˆ†è¯åº“åŒ¹é…çš„è¶Šå¤šåŒ¹é…è¶Šé«˜

    ```json
    POST /sms_logs_index/_search
    {
      "query": {
        "boosting": {
          "positive": {			# åŒ¹é…ç»“æœå™¨
            "term": {
              "smsContent": {
                "value": "æ¿€"
              }
            }
          },
          "negative": {			# åŒ¹é…ç»“æœå™¨å¹¶ä¸”åŒ¹é…negative
            "match": {
              "fee": "25"
            }
          },
          "negative_boost": 0.2	# å°±æŠŠè¿™ä¸ªæ•°æ®çš„scrollåˆ†æ•°é™ä½0.2
        }
      }
    }
    ```

16. filteræŸ¥è¯¢ï¼šæ ¹æ®æŸ¥è¯¢æ¡ä»¶æŸ¥è¯¢æ–‡æ¡£ï¼Œä¸è®¡ç®—åˆ†æ•°ï¼Œfilterä¼šå¯¹ç»å¸¸è¿‡æ»¤çš„æ•°æ®è¿›è¡Œç¼“å­˜

    ```json
    POST /sms_logs_index/_search
    {
      "query": {
        "bool": {
          "filter": [
            {
              "term": {
                "smsContent": "çŸ­"
              }
            },
            {
              "range": {
                "fee": {
                  "gte": 20,
                  "lte": 30
                }
              }
            }
          ]
        }
      }
    }
    ```

17. é«˜äº®æ˜¾ç¤ºï¼šqueryçš„åŒçº§å±æ€§heightlight

    - fragment_sizeï¼šæŒ‡å®šé«˜äº®å±•ç¤ºæ•°æ®çš„å­—ç¬¦æ•°
    - pre_tagsï¼šæŒ‡å®šå‰ç¼€æ ‡ç­¾
    - post_tagsï¼šæŒ‡å®šåç¼€æ ‡ç­¾

    ```json
    POST /sms_logs_index/_search
    {
      "query": {
        "match": {
          "smsContent": "ä¿¡"
        }
      },
      "highlight": {
        "fields": {
          "smsContent":{}
        }
      }
    }
    ```

18. èšåˆæŸ¥è¯¢cardinality

    ```json
    POST /sms_logs_index/_search
    {
      "aggs": {
        "agg": {
          "cardinality": {
            "field": "fee"
          }
        }
      }
    }
    ```

19. èšåˆæŸ¥è¯¢range

    ```json
    
    ```

20. èšåˆæŸ¥è¯¢extended_stats

    ```json
    
    ```

21. ç»çº¬åº¦

    - æ•°æ®å‡†å¤‡

      ```json
      
      ```

    - ç»çº¬åº¦æŸ¥è¯¢

      ```json
      
      ```

## 3.5 ElasticSearché›†ç¾¤

1. é›†ç¾¤ï¼ˆClusterï¼‰ï¼šä¸€ä¸ªé›†ç¾¤å°±æ˜¯å°±æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ç»„ç»‡åœ¨ä¸€èµ·ï¼Œå…±åŒæŒæœ‰æ•´ä¸ªæ•°æ®ï¼Œå¹¶ä¸€èµ·æä¾›ç´¢å¼•åŠŸèƒ½ã€‚ä¸€ä¸ªElasticSearché›†ç¾¤ç”±ä¸€ä¸ªå”¯ä¸€çš„åç§°æ ‡è¯†ï¼Œé›†ç¾¤ä¸­èŠ‚ç‚¹åªèƒ½é€šè¿‡æŒ‡å®šæŸä¸ªé›†ç¾¤åç§°æ¥åŠ å…¥åˆ°è¿™ä¸ªé›†ç¾¤

2. èŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼šé›†ç¾¤ä¸­åŒ…å«å¾ˆå¤šESæœåŠ¡å™¨ï¼Œä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼›

3. é›†ç¾¤æ­å»º

   - Windowsç³»ç»Ÿï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ã€
   - Linuxç³»ç»Ÿï¼š
   - Dockerç¯å¢ƒï¼š

4. æ ¸å¿ƒæ¦‚å¿µ

   - ç´¢å¼•ï¼š
   - ç±»å‹ï¼šè¿‡æ—¶ï¼Œé»˜è®¤æ˜¯_doc
   - æ–‡æ¡£
   - å­—æ®µ
   - æ˜ å°„ï¼šç´¢å¼•ä¸­æ–‡æ¡£å­—æ®µçš„çº¦æŸ
   - åˆ†ç‰‡ï¼šä¸€ä¸ªç´¢å¼•ä¼šéå¸¸å¤§ï¼Œç´¢å¼•å¯ä»¥åˆ†ç‰‡ï¼Œæ”¾åœ¨ä¸åŒçš„æœåŠ¡ä¸­ï¼Œå¯ä»¥æ°´å¹³åˆ‡å‰²ï¼Œå¹¶ä¸”æ”¯æŒåˆ†å¸ƒå¼æŸ¥è¯¢ï¼›
   - å‰¯æœ¬ï¼šå•ä¸ªåˆ†ç‰‡çš„æœåŠ¡å®•æœºåä½¿ç”¨åˆ†ç‰‡å‰¯æœ¬ä¿è¯æ•°æ®

5. ç³»ç»Ÿæ¶æ„ï¼šæœ‰ä¸€ä¸ªmaster

6. ä½†èŠ‚ç‚¹é›†ç¾¤

   - åˆ›å»ºç´¢å¼•å¹¶æŒ‡å®šåˆ†ç‰‡å’Œå‰¯æœ¬

     ```json
     {
       "settings": {
         "number_of_shards": 5,
         "number_of_replicas": 1
       }
     }
     ```

7. æ•…éšœè½¬ç§»ï¼šå½“é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹åœ¨è¿è¡Œæ—¶ï¼Œæ„å‘³ç€ä¼šæœ‰å•ç‚¹æ•…éšœé—®é¢˜ï¼ˆæ²¡æœ‰å†—ä½™ï¼‰ï¼Œè§£å†³æ–¹æ¡ˆæ—¶å†å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹å³å¯é˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚èŠ‚ç‚¹åŠ å…¥é›†ç¾¤åå‰¯æœ¬ä¼šé‡æ–°åˆ†é…

8. æ°´å¹³æ‰©å®¹ï¼šæ­£åœ¨å¢é•¿çš„åº”ç”¨æ·»åŠ ESæœåŠ¡å®¹é‡ï¼Œéœ€è¦æ·»åŠ æ–°çš„æœåŠ¡èŠ‚ç‚¹ï¼šä¸ºäº†åˆ†æ•£è´Ÿè½½å¯¹åˆ†ç‰‡é‡æ–°åˆ†é…ï¼›ä¸»åˆ†ç‰‡çš„æ•°é‡åœ¨åˆ›å»ºç´¢å¼•æ—¶å€™å°±ç¡®å®šä¸‹æ¥äº†ï¼Œå®é™…ä¸Šè¿™ä¸ªæ•°ç›®å®šä¹‰äº†è¿™ä¸ªç´¢å¼•èƒ½å¤Ÿå‚¨å­˜çš„æœ€å¤§æ•°æ®é‡ï¼Œä½†æ˜¯è¯»æ“ä½œå¯ä»¥åŒæ—¶è¢«ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡æ‰€å¤„ç†ï¼Œæ‰€ä»¥å‰¯æœ¬å¯ä»¥æé«˜æ£€ç´¢ååé‡ï¼›

9. åº”å¯¹æ•…éšœï¼šä¸»èŠ‚ç‚¹å®•æœºåï¼Œmasterè¢«ä»èŠ‚ç‚¹è·å–ï¼Œå†å¤æ´»åå˜æˆäº†ä»èŠ‚ç‚¹ï¼›

10. è·¯ç”±è®¡ç®—ï¼šhashä¸»é”®å¹¶ä¸”å¯¹åˆ†ç‰‡æ•°é‡å–æ¨¡ï¼Œè®¡ç®—çš„ç»“æœå°±æ˜¯åˆ†ç‰‡ç´¢å¼•ï¼›æŸ¥è¯¢æ—¶å€™ç”±åˆ†ç‰‡æ§åˆ¶å»å“ªä¸ªåˆ†ç‰‡æŸ¥è¯¢ï¼›

11. æ•°æ®å†™æµç¨‹ï¼šå®¢æˆ·ç«¯è¯·æ±‚é›†ç¾¤ã€åè°ƒèŠ‚ç‚¹å°†è¯·æ±‚åˆ†å‘åˆ°æŒ‡å®šèŠ‚ç‚¹ã€ä¸»åˆ†ç‰‡ä¿å­˜æ•°æ®ã€ä¸»åˆ†ç‰‡å°†æ•°æ®åˆ†å‘ç»™å‰¯æœ¬ã€å‰¯æœ¬ä¿å­˜æˆåŠŸåé¦ˆã€ä¸»åˆ†ç‰‡åé¦ˆã€å®¢æˆ·ç«¯è·å–åé¦ˆï¼›é€šè¿‡ä¸€è‡´æ€§å‚æ•°è¿›è¡Œè®¾ç½®

12. æ•°æ®è¯»æµç¨‹ï¼šè¯·æ±‚å‘é€åˆ°é›†ç¾¤åè°ƒèŠ‚ç‚¹ã€åè°ƒèŠ‚ç‚¹è®¡ç®—æ•°æ®æ‰€åœ¨åˆ†ç‰‡ä»¥åŠå…¨éƒ¨å‰¯æœ¬ä½ç½®ã€å°†è¯·æ±‚è½¬å‘ç»™æŒ‡å®šèŠ‚ç‚¹ã€è¿”å›æŸ¥è¯¢ç»“æœ

13. æ›´æ–°æµç¨‹ï¼šéƒ¨åˆ†æ›´æ–°éœ€è¦å…ˆè¯»å–å†æ›´æ–°ï¼›

14. æ‰¹é‡æ–°å¢æµç¨‹ï¼š

15. åˆ†ç‰‡è¿œç¦»ï¼šåˆ†ç‰‡æ˜¯ESæœ€å°å·¥ä½œå•å…ƒï¼Œ

16. å€’æ’ç´¢å¼•ï¼š

17. æ–‡æ¡£æœç´¢ï¼š

## 3.6 Javaè¿æ¥ElasticSearch

## 3.6 SpringBooté›†æˆElasticSearch

1. é«˜ç‰ˆæœ¬ESä½¿ç”¨RestHighLevelClient

   ```java
   @Bean
   public RestHighLevelClient restHighLevelClient() {
     HttpHost host = new HttpHost("127.0.0.1",9200,"http");
     RestClientBuilder clientBuilder = RestClient.builder(host);
     return new RestHighLevelClient(clientBuilder);
   }
   ```

2. 

# ç¬¬å››ç«  KibanaåŸºç¡€



# ç¬¬äº”ç«  LogStashåŸºç¡€

# ç¬¬å…­ç«  BeatsåŸºç¡€

RESTfulæ¥å£è¯´æ˜æ¥å£

> åœ¨ElasticSearchä¸­ï¼Œæä¾›äº†ä¸°å¯Œçš„RESTful APIçš„æ“ä½œå®ŒæˆåŸºæœ¬çš„crudã€åˆ›å»ºç´¢å¼•ã€åˆ é™¤ç´¢å¼•ç­‰

1. **åˆ›å»ºéç»“æ„åŒ–ç´¢å¼•**

   â€‹		åœ¨Luceneä¸­åˆ›å»ºç´¢å¼•æ˜¯éœ€è¦å®šä¹‰å­—æ®µåç§°ä»¥åŠå­—æ®µç±»å‹çš„ï¼Œåœ¨ElasticSearchä¸­æä¾›äº†éç»“æ„åŒ–ç´¢å¼•ï¼ˆè¡¨ç»“æ„ä¸å›ºå®šï¼‰ï¼Œå°±æ˜¯ä¸éœ€è¦åˆ›å»ºç´¢å¼•ç»“æ„å³å¯å°†æ•°æ®å†™å…¥åˆ°ç´¢å¼•ä¸­ï¼Œå®é™…ä¸ŠElasticSearchåº•å±‚ä¼šè¿›è¡Œç»“æ„åŒ–æ“ä½œï¼Œæ­¤æ“ä½œç”¨æˆ·æ˜¯ä¸éœ€è¦å…³æ³¨çš„ã€‚

   - åˆ›å»ºç©ºç´¢å¼•ï¼š<kbd>PUT è¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/ç´¢å¼•åç§°</kbd>

     ```json
     # http://120.27.22.124:9200/panda
     {
     	"settings":{
     		"index":{
     			"number_of_shard":"2",
     			"number_of_replicas":"0"
     		}
     	}
     }
     ```

   - åˆ é™¤ç´¢å¼•ï¼š<kbd>DELETEè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/ç´¢å¼•åç§°</kbd>

     ```json
     # http://120.27.22.124:9200/panda
     ```

2. **æ’å…¥æ•°æ®**

   - URLè§„åˆ™ï¼š<kbd>POSTè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/{ç´¢å¼•}/{ç±»å‹}/{id}</kbd>

     ```json
     # http://120.27.22.124:9200/panda/emp/<001> IDå¯ä»¥ä¸æŒ‡å®š,ä¼šè‡ªåŠ¨ç”Ÿæˆ
     {
         "name":"å¼ ä¸‰",
         "age":23,
         "gender":"ç”·"
     }
     
     # å“åº”ï¼šresultçš„å€¼æ˜¯created
     {
         "result": "created",
     }
     ```

3. **æ›´æ–°æ•°æ®ï¼š**ElasticSearchæœ¬è´¨æ˜¯ä¸å…è®¸æ›´æ–°ï¼Œå¯ä»¥é‡‡ç”¨åŒIDæ–‡æ¡£è¿›è¡Œè¦†ç›–å®Œæˆæ›´æ–°ï¼Œå…¨é‡è¦†ç›–

   - å…¨é‡è¦†ç›–URLè§„åˆ™ï¼š<kbd>PUTè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/{ç´¢å¼•}/{ç±»å‹}/{id}</kbd>

     ```json
     # http://127.0.0.1:9200/panda/user/1001
     {
     	"id":"1002",
         "name":"ç›ˆç›ˆ",
         "age":13,
         "gender":"å¥³"
     }
     
     # å“åº”ï¼šresultçš„å€¼æ˜¯updatedå¹¶ä¸”_versionçš„å€¼ä¼šè‡ªå¢1
     {
         "_version": 2,
         "result": "updated",
     }
     ```

   - å±€éƒ¨æ›´æ–°URLè§„åˆ™ï¼š<kbd>POSTè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/{ç´¢å¼•}/{ç±»å‹}/{id}/_update</kbd>ï¼Œéœ€è¦æ›´æ–°çš„è‡ªåŠ¨ç”¨docåŒ…è£…

     ```json
     # http://127.0.0.1:9200/panda/user/1001/_update
     {
     	"doc":{
     		"name":"ä»¤ç‹å†²"
     	}
     }
     ```

4. **åˆ é™¤æ•°æ®ï¼š**åˆ é™¤ä¸å­˜åœ¨çš„æ•°æ®ä¼šå‡ºå¼‚å¸¸

   - åˆ é™¤URLï¼š<kbd>DELETEè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/{ç´¢å¼•}/{ç±»å‹}/{id}</kbd>

     ```http
     http://127.0.0.1:9200/panda/user/1001 åˆ é™¤ä¸ä¼šç«‹å³ç§»é™¤å‡ºç£ç›˜,ç­‰åç»­åˆ é™¤æ­¥éª¤ä¸€èµ·æ‰§è¡Œ
     ```

5. **æœç´¢æ•°æ®**

   - ä½¿ç”¨IDè¿›è¡Œæœç´¢ï¼š<kbd>GETè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/{ç´¢å¼•}/{ç±»å‹}/{id}</kbd>

     ```http
     http://127.0.0.1:9200/panda/user/1001
     ```

   - è¿”å›å…¨éƒ¨ï¼ˆé»˜è®¤10æ¡ï¼‰æ•°æ®ï¼š<kbd>GETè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/{ç´¢å¼•}/{ç±»å‹}/{id}/_search</kbd>

     ```http
     http://127.0.0.1:9200/panda/user/_search
     ```

   - ä½¿ç”¨æŸ¥è¯¢å‚æ•°ï¼š<kbd>GETè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/{ç´¢å¼•}/{ç±»å‹}/{id}/_search?q=å­—æ®µ:æ¡ä»¶å€¼</kbd>

     ```http
     http://127.0.0.1:9200/panda/user/_search?q=age:>20
     ```

6. **DSLæœç´¢ï¼š**ElasticSearchæä¾›ä¸°å¯Œçµæ´»çš„æŸ¥è¯¢è¯­è¨€ï¼Œé¢†åŸŸç‰¹å®šè¯­è¨€

   - åŸºæœ¬æ ¼å¼ï¼š<kbd>POSTè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/{ç´¢å¼•}/{ç±»å‹}/{id}/_search</kbd>

     ```json
     {
         "quary":{
             "æŸ¥è¯¢ç±»å‹":{
                 "å­—æ®µ":"å€¼"
             }
         }
     }
     ```

     - æŸ¥è¯¢ç±»å‹ï¼š

7. **é«˜äº®æ˜¾ç¤º**

8. **èšåˆ**

RESTfulæ¥å£è¯´æ˜

- getè¯·æ±‚

  ```http
  http://ip:ç«¯å£/index	 				// æŸ¥è¯¢ç´¢å¼•ä¿¡æ¯
  http://ip:ç«¯å£/index/type/dock_id		// æŸ¥è¯¢æŒ‡å®šçš„æ–‡æ¡£ä¿¡æ¯
  ```

- postè¯·æ±‚

  ```http
  http://ip:ç«¯å£/index/type/_search			// æŸ¥è¯¢,è¯·æ±‚ä½“åŒ…å«jsonå‚æ•°
  http://ip:ç«¯å£/index/type/_update			// ä¿®æ”¹,è¯·æ±‚ä½“åŒ…å«jsonå‚æ•°
  ```

- putè¯·æ±‚

  ```http
  http://ip:ç«¯å£/index					// åˆ›å»ºç´¢å¼•,è¯·æ±‚ä½“åŒ…å«ç´¢å¼•ä¿¡æ¯
  http://ip:ç«¯å£/index/type/_mappings	// ä»£è¡¨åˆ›å»ºç´¢å¼•æ—¶å€™,æŒ‡å®šç´¢å¼•æ–‡æ¡£å­˜å‚¨çš„å±æ€§çš„ä¿¡æ¯
  ```

- deleteè¯·æ±‚

  ```http
  http://ip:ç«¯å£/index					// åˆ åº“è·‘è·¯
  http://ip:ç«¯å£/index/type/dock_id		// åˆ é™¤æŒ‡å®šçš„æ–‡æ¡£ä¿¡æ¯
  ```

3.1 æ–‡æ¡£

- å…ƒæ•°æ®ï¼šmatedata

  ```json
  {
      "_index":"ç´¢å¼•",
      "_type":"å¯¹è±¡ç±»å‹",
      "_id":"æ–‡æ¡£å”¯ä¸€ä¸»é”®"
  }
  ```

  > - _indexï¼šç±»ä¼¼å…³ç³»å‹æ•°æ®åº“ä¸­çš„æ•°æ®åº“ï¼Œæ˜¯ESå­˜å‚¨å’Œç´¢å¼•å…³è”æ•°æ®çš„åœ°æ–¹ï¼›äº‹å®ä¸Šï¼ŒESçš„æ•°æ®è¢«å­˜å‚¨åœ¨åˆ†ç‰‡ä¸Šï¼Œç´¢å¼•åªæ˜¯ä¸€ä¸ªæŠŠä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ç»„åœ¨ä¸€èµ·çš„é€»è¾‘ç©ºé—´ï¼Œè€Œå¯¹ç¨‹åºè€Œè¨€ï¼Œæ–‡æ¡£æ˜¯å­˜å‚¨åœ¨ç´¢å¼•ä¸­
  > - _typeï¼šåœ¨åº”ç”¨ä¸­ï¼Œä¸‡ç‰©çš†å¯¹è±¡ï¼ŒæŸä¸€ç±»å¯¹è±¡å¯ä»¥æŠ½è±¡ä¸ºä¸€ç§ç±»å‹ï¼Œtypeç”¨äºæè¿°æ•°æ®çš„ç±»å‹ï¼Œæ„å‘³ç€åŒä¸€ç±»å‹çš„æ•°æ®è¡¨ç¤ºç›¸åŒçš„äº‹ç‰©ã€‚åœ¨ESä¸­æ¯ä¸ªç±»å‹éƒ½æœ‰è‡ªå·± æ˜ å°„æˆ–è€…ç»“æ„å®šä¹‰
  > - _idï¼šå¦‚æœä¸æ‰‹åŠ¨æŒ‡å®šå°±ç”±ESè‡ªåŠ¨ç”Ÿæˆ32ä¸ºå­—ç¬¦ä¸²ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†æ–‡æ¡£

3.2 æŸ¥è¯¢ç›¸åº”

1.  **prettyï¼šæ ¼å¼åŒ–æŸ¥è¯¢ç»“æœ**

   ```http
   http://127.0.0.1:9200/panda/user/_search?pretty
   ```

2. **_source=æŒ‡å®šç›¸åº”å­—æ®µ**

   - `?_source=age,name`è¿”å›åˆ—è¡¨ä¸­æŒ‡å®šå­—æ®µ

     ```http
     http://127.0.0.1:9200/panda/user/_search?_source=age,name
     ```

   - `/id/_source`ï¼šåªè¿”å›å®ä½“æ•°æ®

     ```http
     http://127.0.0.1:9200/panda/user/1001/_source
     ```

   - `/id/_source?_source=age`ï¼šè¿”å›å®ä½“æ•°æ®çš„æŒ‡å®šå­—æ®µ

     ```sh
     http://127.0.0.1:9200/panda/user/1001/_source?_source=age
     ```

3.3 åˆ¤æ–­æ–‡æ¡£æ˜¯å¦å­˜åœ¨

1. æ ¹æ®æŸ¥è¯¢ç»“æœçš„`found`å±æ€§ï¼štrueæ ‡è¯†å­˜åœ¨ï¼Œfalseè¡¨ç¤ºä¸å­˜åœ¨
2. å‘é€HEADè¯·æ±‚ï¼šç›¸åº”200è¡¨ç¤ºå­˜åœ¨ï¼Œå¦åˆ™è¡¨ç¤ºä¸å­˜åœ¨

3.4 æ‰¹é‡æ“ä½œ

1. æ‰¹é‡æŸ¥è¯¢ï¼š<kbd>POSTè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/{ç´¢å¼•}/{ç±»å‹}/_mget</kbd>

   ```json
   # http://127.0.0.1:9200/panda/user/_mget
   {
   	"ids":["1001","1002"]
   }
   ```

2. _bulkï¼šæ‰¹é‡æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤ï¼› <kbd>POSTè¯·æ±‚ --> ElasticSearchæœåŠ¡åœ°å€/{ç´¢å¼•}/{ç±»å‹}/\bulk</kbd>

   ```json
   {"åŠ¨ä½œ":{"_index":"ç´¢å¼•","_type":"ç±»å‹","_id":"ä¸»é”®"}}
   {è¯·æ±‚ä½“}\n
   ```

   > - åŠ¨ä½œï¼šcreate=æ’å…¥ã€update=ä¿®æ”¹ã€delete=åˆ é™¤
   >   - deleteæ²¡æœ‰è¯·æ±‚ä½“
   > - è¯·æ±‚ä½“åå¿…é¡»æœ‰æ¢è¡Œç¬¦

3. æ‰¹é‡è¯·æ±‚æ€§èƒ½è¯´æ˜ï¼šESæ‰¹é‡æ“ä½œçš„æœ€ä½³æ€§èƒ½

   - æ‰¹é‡è¯·æ±‚æ˜¯éœ€è¦è¢«åŠ è½½åˆ°æ¥å—è¯·æ±‚èŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¯·æ±‚è¶Šå¤§ï¼Œå…¶ä»–è¯·æ±‚çš„å†…å­˜å°±è¶Šå°
   - æœ€ä½³çš„è¯·æ±‚å¤§å°å–å†³ä¸ç¡¬ä»¶ã€æ–‡æ¡£å¤§å°ã€å¤æ‚åº¦ä»¥åŠç´¢å¼•å’Œè¦æœç´ çš„è´Ÿè½½

3.5 åˆ†é¡µ

- formï¼šèµ·å§‹åç§»é‡

- sizeï¼šæ¯é¡µæ˜¾ç¤ºæ•°é‡

  ```json
  GET /_search?size=5
  GET /_search?size=5&from=10
  ```

3.6 æ˜ å°„

â€‹		ESå¯ä»¥è¿›è¡Œæ˜ç¡®çš„å­—æ®µç±»å‹è¯´æ˜ï¼Œåœ¨æ“ä½œæ•°æ®æ—¶å€™å¯ä»¥æ ¹æ®æ•°æ®ç±»å‹åˆ¤æ–­æ•°æ®ä¸å®é™…å­—æ®µæ˜¯å¦ç¬¦åˆ

- è‡ªåŠ¨åˆ¤æ–­è§„åˆ™

  | JSON Type               | å­—æ®µç±»å‹  |
  | ----------------------- | --------- |
  | Booleanå€¼:true æˆ– false | "boolean" |
  | æ•´æ•°æ•°å­—                | "long"    |
  | å°æ•°æ•°å­—                | "double"  |
  | æ—¥æœŸæ ¼å¼çš„å­—ç¬¦ä¸²        | "date"    |
  | åŒ…å«å­—æ¯ç­‰å­—ç¬¦ä¸²        | "string"  |

- ESä¸­æ”¯æŒçš„æ•°æ®ç±»å‹

  | ç±»å‹     | è¡¨ç¤ºçš„æ•°æ®ç±»å‹             |
  | -------- | -------------------------- |
  | String   | stringã€textã€keyword      |
  | number   | byteã€shortã€integerã€long |
  | floating | floatã€double              |
  | Boolean  | boolean                    |
  | Date     | date                       |

  > - stringç±»å‹åœ¨æ—§ç‰ˆESä¸­ä½¿ç”¨ï¼Œåœ¨ES5.xç‰ˆæœ¬ä¹‹åä¸å†æ”¯æŒstringï¼Œç”±textå’Œkeywordæ›¿ä»£
  > - textç±»å‹ï¼šå½“ä¸€ä¸ªå­—æ®µæ˜¯è¦è¢«å…¨æ–‡æœç´ çš„ï¼Œåº”è¯¥ä½¿ç”¨textç±»å‹ï¼Œè®¾ç½®textç±»å‹åï¼Œå­—æ®µå†…å®¹ä¼šè¢«åˆ†æï¼Œåœ¨ç”Ÿæˆå€’æ’ç´¢å¼•ä»¥å‰ï¼Œå­—ç¬¦ä¸²ä¼šè¢«åˆ†æå™¨åˆ†æˆä¸€ä¸ªä¸ªçš„è¯é¡¹ï¼Œtextç±»å‹çš„å­—æ®µä¸ç”¨äºæ’åºï¼Œå¾ˆå°‘ç”¨èšåˆ
  > - keywordç±»å‹ï¼šé€‚ç”¨äºç´¢å¼•ç»“æ„åŒ–çš„å­—æ®µï¼Œkeywordå­—æ®µåªèƒ½é€šè¿‡ç²¾ç¡®å€¼æœç´¢åˆ°

- åˆ›å»ºæ˜ç¡®ç±»å‹çš„ç´¢å¼•

  ```json
  # http://127.0.0.1:9200/panda
  {
      "settings":{
          "number_of_shards":2,
          "number_of_replicas":1
       }, 
      "mappings" : {
          "properties":{
              "id":{
                  "type":"text"
              },
              "title":{
                  "type":"text"
              },
              "content":{
                  "type":"text"
              }
          }
      }
  }
  ```

- æŸ¥è¯¢æ˜ å°„

  ```http
  GET /ç´¢å¼•/ç±»å‹/_mapping
  ```

  

3.7 ç»“æ„åŒ–æŸ¥è¯¢

1. ESä»‹ç»

   

2. ESå®‰è£…

3. ESåŸºæœ¬æ“ä½œ

4. ES Java

5. ESç»ƒä¹ 

6. ESæŸ¥è¯¢è¿›é˜¶